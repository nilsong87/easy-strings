adicionar este codigo = (<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualizador Completo de Acordes</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome para ícones -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            background-color: #f8f9fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding-bottom: 50px;
        }
        .header {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            padding: 2rem 0;
            margin-bottom: 2rem;
            border-radius: 0 0 10px 10px;
        }
        
        .footer {
            text-align: center;
            padding: 20px;
            margin-top: 30px;
            color: #777;
            font-size: 0.9em;
        }
        .instructions {
            background-color: #e8f5e9;
            border-left: 4px solid #4caf50;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        .category-badge {
            font-size: 0.8em;
            padding: 3px 8px;
            border-radius: 10px;
            margin-left: 5px;
        }
        .badge-major {
            background-color: #ff5722;
            color: white;
        }
        .badge-minor {
            background-color: #673ab7;
            color: white;
        }
        .badge-7 {
            background-color: #e91e63;
            color: white;
        }
        .badge-m7 {
            background-color: #009688;
            color: white;
        }
        .badge-maj7 {
            background-color: #3f51b5;
            color: white;
        }
        @media (max-width: 768px) {
            .chord-diagram {
                min-height: 200px;
            }
            .fret {
                width: 30px;
                height: 150px;
            }
        }
    </style>
</head>
<body>
    <div class="header text-center">
        <div class="container">
            <h1><i class="fas fa-guitar me-2"></i>Visualizador Completo de Acordes</h1>
            <p class="lead">Explore todos os acordes maiores, menores, com sétima, menor sétima e maior sétima</p>
        </div>
    </div>

    <div class="container">
        <div class="instructions">
            <h5><i class="fas fa-info-circle me-2"></i>Como usar</h5>
            <p class="mb-0">Selecione um acorde da lista ou use os menus para escolher o tipo e a nota base. O diagrama será exibido automaticamente.</p>
        </div>
        
        <div class="row">
            <div class="col-md-4">
                <div class="chord-selector">
                    <h4><i class="fas fa-list me-2"></i>Seletor de Acordes</h4>
                    <div class="mb-3">
                        <label for="chordType" class="form-label">Tipo de Acorde:</label>
                        <select class="form-select" id="chordType">
                            <option value="major">Maior</option>
                            <option value="minor">Menor</option>
                            <option value="7">Sétima</option>
                            <option value="m7">Menor Sétima</option>
                            <option value="maj7">Maior Sétima</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="chordRoot" class="form-label">Nota Base:</label>
                        <select class="form-select" id="chordRoot">
                            <option value="C">Dó (C)</option>
                            <option value="C#">Dó# (C#)</option>
                            <option value="D">Ré (D)</option>
                            <option value="D#">Ré# (D#)</option>
                            <option value="E">Mi (E)</option>
                            <option value="F">Fá (F)</option>
                            <option value="F#">Fá# (F#)</option>
                            <option value="G">Sol (G)</option>
                            <option value="G#">Sol# (G#)</option>
                            <option value="A">Lá (A)</option>
                            <option value="A#">Lá# (A#)</option>
                            <option value="B">Si (B)</option>
                        </select>
                    </div>
                    
                    <button id="showChord" class="btn btn-primary w-100 mb-3">
                        <i class="fas fa-eye me-2"></i>Mostrar Acorde
                    </button>
                    
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="showAllChords">
                        <label class="form-check-label" for="showAllChords">Mostrar todos os acordes</label>
                    </div>
                    
                    <hr>
                    
                    <h5>Acordes Frequentes:</h5>
                    <div class="chord-list" id="commonChords">
                        <!-- Acordes frequentes serão adicionados via JavaScript -->
                    </div>
                </div>
            </div>
            
            <div class="col-md-8">
                <div class="chord-diagram">
                    <div class="text-center" id="chordContainer">
                        <h3 id="chordName" class="mb-4">Selecione um acorde</h3>
                        <div id="fretboard" class="fretboard">
                            <!-- O diagrama do acorde será gerado aqui -->
                        </div>
                    </div>
                </div>
                
                <div class="row mt-4">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title"><i class="fas fa-info-circle me-2"></i>Como ler o diagrama</h5>
                                <ul class="list-group list-group-flush">
                                    <li class="list-group-item"><span class="note" style="display: inline-block; width: 25px; height: 25px;"></span> Nota pressionada</li>
                                    <li class="list-group-item"><span class="note open" style="display: inline-block; width: 25px; height: 25px;">O</span> Corda solta</li>
                                    <li class="list-group-item"><span class="note muted" style="display: inline-block; width: 25px; height: 25px;">X</span> Corda não tocada</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title"><i class="fas fa-music me-2"></i>Dica de Prática</h5>
                                <p class="card-text">Comece com acordes simples como Dó Maior (C), Lá Menor (Am) e Mi Menor (Em). Pratique a transição suave entre eles.</p>
                                <p class="card-text">Use um metrônomo para melhorar seu ritmo.</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card mt-4" id="allChordsSection" style="display: none;">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="fas fa-grid me-2"></i>Todos os Acordes</h5>
                    </div>
                    <div class="card-body">
                        <div class="row" id="allChordsGrid">
                            <!-- Todos os acordes serão adicionados aqui via JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="footer">
        <div class="container">
            <p>Visualizador Completo de Acordes &copy; 2023 - Todos os direitos reservados</p>
        </div>
    </div>

    <!-- Bootstrap JS e Popper.js -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Dados completos dos acordes (posições dos dedos)
            const chordData = {
                // Acordes Maiores
                'C-major': { name: 'Dó Maior (C)', frets: [0, 3, 2, 0, 1, 0], fingers: ['X', '3', '2', 'X', '1', 'X'] },
                'C#-major': { name: 'Dó# Maior (C#)', frets: [4, 6, 6, 5, 4, 4], fingers: ['1', '3', '4', '2', '1', '1'] },
                'D-major': { name: 'Ré Maior (D)', frets: [2, 3, 2, 0, 0, 0], fingers: ['2', '3', '1', 'X', 'X', 'X'] },
                'D#-major': { name: 'Ré# Maior (D#)', frets: [6, 8, 8, 7, 6, 6], fingers: ['1', '3', '4', '2', '1', '1'] },
                'E-major': { name: 'Mi Maior (E)', frets: [0, 0, 1, 2, 2, 0], fingers: ['O', 'O', '1', '3', '2', 'O'] },
                'F-major': { name: 'Fá Maior (F)', frets: [1, 1, 2, 3, 3, 1], fingers: ['1', '1', '2', '4', '3', '1'] },
                'F#-major': { name: 'Fá# Maior (F#)', frets: [2, 2, 3, 4, 4, 2], fingers: ['1', '1', '2', '4', '3', '1'] },
                'G-major': { name: 'Sol Maior (G)', frets: [3, 2, 0, 0, 0, 3], fingers: ['2', '1', 'O', 'O', 'O', '3'] },
                'G#-major': { name: 'Sol# Maior (G#)', frets: [4, 3, 1, 1, 1, 4], fingers: ['2', '1', '1', '1', '1', '3'] },
                'A-major': { name: 'Lá Maior (A)', frets: [0, 0, 2, 2, 2, 0], fingers: ['O', 'O', '2', '3', '1', 'O'] },
                'A#-major': { name: 'Lá# Maior (A#)', frets: [1, 1, 3, 3, 3, 1], fingers: ['1', '1', '3', '4', '2', '1'] },
                'B-major': { name: 'Si Maior (B)', frets: [2, 2, 4, 4, 4, 2], fingers: ['1', '1', '3', '4', '2', '1'] },
                
                // Acordes Menores
                'C-minor': { name: 'Dó Menor (Cm)', frets: [3, 3, 5, 5, 4, 3], fingers: ['1', '1', '4', '3', '2', '1'] },
                'C#-minor': { name: 'Dó# Menor (C#m)', frets: [4, 4, 6, 6, 5, 4], fingers: ['1', '1', '4', '3', '2', '1'] },
                'D-minor': { name: 'Ré Menor (Dm)', frets: [1, 3, 2, 0, 0, 0], fingers: ['1', '3', '2', 'X', 'X', 'X'] },
                'D#-minor': { name: 'Ré# Menor (D#m)', frets: [2, 4, 3, 1, 0, 0], fingers: ['2', '4', '3', '1', 'X', 'X'] },
                'E-minor': { name: 'Mi Menor (Em)', frets: [0, 0, 0, 2, 2, 0], fingers: ['O', 'O', 'O', '2', '3', 'O'] },
                'F-minor': { name: 'Fá Menor (Fm)', frets: [1, 1, 1, 3, 3, 1], fingers: ['1', '1', '1', '4', '3', '1'] },
                'F#-minor': { name: 'Fá# Menor (F#m)', frets: [2, 2, 2, 4, 4, 2], fingers: ['1', '1', '1', '4', '3', '1'] },
                'G-minor': { name: 'Sol Menor (Gm)', frets: [3, 3, 3, 5, 5, 3], fingers: ['1', '1', '1', '4', '3', '1'] },
                'G#-minor': { name: 'Sol# Menor (G#m)', frets: [4, 4, 4, 6, 6, 4], fingers: ['1', '1', '1', '4', '3', '1'] },
                'A-minor': { name: 'Lá Menor (Am)', frets: [0, 1, 2, 2, 0, 0], fingers: ['O', '1', '3', '2', 'O', 'O'] },
                'A#-minor': { name: 'Lá# Menor (A#m)', frets: [1, 2, 3, 3, 1, 1], fingers: ['1', '2', '4', '3', '1', '1'] },
                'B-minor': { name: 'Si Menor (Bm)', frets: [2, 3, 4, 4, 2, 2], fingers: ['1', '2', '4', '3', '1', '1'] },
                
                // Acordes com Sétima
                'C-7': { name: 'Dó Sétima (C7)', frets: [0, 3, 2, 3, 1, 0], fingers: ['O', '3', '2', '4', '1', 'O'] },
                'C#-7': { name: 'Dó# Sétima (C#7)', frets: [1, 4, 3, 4, 2, 1], fingers: ['1', '4', '3', '4', '2', '1'] },
                'D-7': { name: 'Ré Sétima (D7)', frets: [2, 3, 2, 3, 0, 0], fingers: ['1', '3', '2', '4', 'X', 'X'] },
                'D#-7': { name: 'Ré# Sétima (D#7)', frets: [3, 4, 3, 4, 1, 1], fingers: ['2', '4', '3', '4', '1', '1'] },
                'E-7': { name: 'Mi Sétima (E7)', frets: [0, 0, 1, 0, 2, 0], fingers: ['O', 'O', '1', 'O', '3', 'O'] },
                'F-7': { name: 'Fá Sétima (F7)', frets: [1, 1, 2, 1, 3, 1], fingers: ['1', '1', '2', '1', '4', '1'] },
                'F#-7': { name: 'Fá# Sétima (F#7)', frets: [2, 2, 3, 2, 4, 2], fingers: ['1', '1', '2', '1', '4', '1'] },
                'G-7': { name: 'Sol Sétima (G7)', frets: [3, 2, 0, 0, 0, 1], fingers: ['3', '2', 'O', 'O', 'O', '1'] },
                'G#-7': { name: 'Sol# Sétima (G#7)', frets: [4, 3, 1, 1, 1, 2], fingers: ['4', '3', '1', '1', '1', '2'] },
                'A-7': { name: 'Lá Sétima (A7)', frets: [0, 0, 2, 0, 2, 0], fingers: ['O', 'O', '2', 'O', '3', 'O'] },
                'A#-7': { name: 'Lá# Sétima (A#7)', frets: [1, 1, 3, 1, 3, 1], fingers: ['1', '1', '3', '1', '4', '1'] },
                'B-7': { name: 'Si Sétima (B7)', frets: [2, 1, 2, 0, 2, 0], fingers: ['2', '1', '3', 'X', '4', 'X'] },
                
                // Acordes Menor Sétima
                'C-m7': { name: 'Dó Menor Sétima (Cm7)', frets: [3, 3, 5, 3, 4, 3], fingers: ['1', '1', '4', '1', '3', '1'] },
                'C#-m7': { name: 'Dó# Menor Sétima (C#m7)', frets: [4, 4, 6, 4, 5, 4], fingers: ['1', '1', '4', '1', '3', '1'] },
                'D-m7': { name: 'Ré Menor Sétima (Dm7)', frets: [1, 3, 1, 0, 0, 0], fingers: ['1', '3', '2', 'X', 'X', 'X'] },
                'D#-m7': { name: 'Ré# Menor Sétima (D#m7)', frets: [2, 4, 2, 1, 0, 0], fingers: ['2', '4', '3', '1', 'X', 'X'] },
                'E-m7': { name: 'Mi Menor Sétima (Em7)', frets: [0, 0, 0, 0, 2, 0], fingers: ['O', 'O', 'O', 'O', '2', 'O'] },
                'F-m7': { name: 'Fá Menor Sétima (Fm7)', frets: [1, 1, 1, 1, 3, 1], fingers: ['1', '1', '1', '1', '4', '1'] },
                'F#-m7': { name: 'Fá# Menor Sétima (F#m7)', frets: [2, 2, 2, 2, 4, 2], fingers: ['1', '1', '1', '1', '4', '1'] },
                'G-m7': { name: 'Sol Menor Sétima (Gm7)', frets: [3, 3, 3, 3, 5, 3], fingers: ['1', '1', '1', '1', '4', '1'] },
                'G#-m7': { name: 'Sol# Menor Sétima (G#m7)', frets: [4, 4, 4, 4, 6, 4], fingers: ['1', '1', '1', '1', '4', '1'] },
                'A-m7': { name: 'Lá Menor Sétima (Am7)', frets: [0, 1, 2, 0, 2, 0], fingers: ['O', '1', '2', 'O', '3', 'O'] },
                'A#-m7': { name: 'Lá# Menor Sétima (A#m7)', frets: [1, 2, 3, 1, 3, 1], fingers: ['1', '2', '4', '1', '3', '1'] },
                'B-m7': { name: 'Si Menor Sétima (Bm7)', frets: [2, 3, 4, 2, 4, 2], fingers: ['1', '2', '4', '1', '3', '1'] },
                
                // Acordes Maior Sétima
                'C-maj7': { name: 'Dó Maior Sétima (Cmaj7)', frets: [0, 3, 2, 0, 0, 0], fingers: ['O', '3', '2', 'O', 'O', 'O'] },
                'C#-maj7': { name: 'Dó# Maior Sétima (C#maj7)', frets: [1, 4, 3, 1, 1, 1], fingers: ['1', '4', '3', '1', '1', '1'] },
                'D-maj7': { name: 'Ré Maior Sétima (Dmaj7)', frets: [2, 3, 2, 4, 0, 0], fingers: ['1', '2', '1', '3', 'X', 'X'] },
                'D#-maj7': { name: 'Ré# Maior Sétima (D#maj7)', frets: [3, 4, 3, 5, 1, 1], fingers: ['2', '3', '2', '4', '1', '1'] },
                'E-maj7': { name: 'Mi Maior Sétima (Emaj7)', frets: [0, 0, 1, 1, 2, 0], fingers: ['O', 'O', '1', '1', '2', 'O'] },
                'F-maj7': { name: 'Fá Maior Sétima (Fmaj7)', frets: [1, 1, 2, 2, 3, 1], fingers: ['1', '1', '2', '2', '4', '1'] },
                'F#-maj7': { name: 'Fá# Maior Sétima (F#maj7)', frets: [2, 2, 3, 3, 4, 2], fingers: ['1', '1', '2', '2', '4', '1'] },
                'G-maj7': { name: 'Sol Maior Sétima (Gmaj7)', frets: [3, 2, 0, 0, 0, 2], fingers: ['2', '1', 'O', 'O', 'O', '3'] },
                'G#-maj7': { name: 'Sol# Maior Sétima (G#maj7)', frets: [4, 3, 1, 1, 1, 3], fingers: ['3', '2', '1', '1', '1', '4'] },
                'A-maj7': { name: 'Lá Maior Sétima (Amaj7)', frets: [0, 0, 2, 1, 2, 0], fingers: ['O', 'O', '2', '1', '3', 'O'] },
                'A#-maj7': { name: 'Lá# Maior Sétima (A#maj7)', frets: [1, 1, 3, 2, 3, 1], fingers: ['1', '1', '4', '2', '3', '1'] },
                'B-maj7': { name: 'Si Maior Sétima (Bmaj7)', frets: [2, 2, 4, 3, 4, 2], fingers: ['1', '1', '4', '2', '3', '1'] }
            };

            // Elementos da interface
            const chordContainer = document.getElementById('chordContainer');
            const chordName = document.getElementById('chordName');
            const fretboard = document.getElementById('fretboard');
            const showChordButton = document.getElementById('showChord');
            const showAllChordsCheckbox = document.getElementById('showAllChords');
            const allChordsSection = document.getElementById('allChordsSection');
            const allChordsGrid = document.getElementById('allChordsGrid');
            const commonChordsList = document.getElementById('commonChords');

            // Acordes frequentes para a lista
            const commonChords = [
                'C-major', 'D-minor', 'E-minor', 'F-major', 'G-major', 
                'A-minor', 'B-7', 'C-maj7', 'D-7', 'G-7', 'E-maj7', 'A-7'
            ];

            // Inicializar a lista de acordes frequentes
            function initCommonChordsList() {
                commonChordsList.innerHTML = '';
                commonChords.forEach(chordKey => {
                    const chord = chordData[chordKey];
                    if (chord) {
                        const item = document.createElement('div');
                        item.className = 'chord-item';
                        item.setAttribute('data-chord', chordKey);
                        
                        // Adicionar badge de categoria
                        let badgeClass = '';
                        if (chordKey.includes('major')) badgeClass = 'badge-major';
                        if (chordKey.includes('minor')) badgeClass = 'badge-minor';
                        if (chordKey.includes('-7') && !chordKey.includes('m7') && !chordKey.includes('maj7')) badgeClass = 'badge-7';
                        if (chordKey.includes('m7')) badgeClass = 'badge-m7';
                        if (chordKey.includes('maj7')) badgeClass = 'badge-maj7';
                        
                        item.innerHTML = `${chord.name} <span class="category-badge ${badgeClass}">${getCategoryName(chordKey)}</span>`;
                        item.addEventListener('click', function() {
                            showChord(chordKey);
                        });
                        commonChordsList.appendChild(item);
                    }
                });
            }

            // Obter nome da categoria a partir da chave do acorde
            function getCategoryName(chordKey) {
                if (chordKey.includes('major')) return 'Maior';
                if (chordKey.includes('minor')) return 'Menor';
                if (chordKey.includes('-7') && !chordKey.includes('m7') && !chordKey.includes('maj7')) return '7ª';
                if (chordKey.includes('m7')) return 'm7';
                if (chordKey.includes('maj7')) return 'maj7';
                return '';
            }

            // Gerar o braço da guitarra
            function generateFretboard(chord) {
                fretboard.innerHTML = '';
                
                // Adicionar labels das cordas
                const strings = ['E', 'A', 'D', 'G', 'B', 'E'];
                for (let i = 0; i < 6; i++) {
                    const stringLabel = document.createElement('div');
                    stringLabel.className = 'string-label';
                    stringLabel.style.top = `${(i * 30) + 13}px`;
                    stringLabel.textContent = strings[i];
                    fretboard.appendChild(stringLabel);
                }
                
                // Criar 5 trastes
                for (let f = 0; f < 5; f++) {
                    const fret = document.createElement('div');
                    fret.className = 'fret';
                    
                    // Adicionar label do traste
                    if (f > 0) {
                        const fretLabel = document.createElement('div');
                        fretLabel.className = 'fret-label';
                        fretLabel.textContent = f;
                        fret.appendChild(fretLabel);
                    }
                    
                    // Adicionar cordas
                    for (let s = 0; s < 6; s++) {
                        const string = document.createElement('div');
                        string.className = 'string';
                        string.style.top = `${(s * 30) + 13}px`;
                        fret.appendChild(string);
                        
                        // Adicionar notas se for o primeiro traste
                        if (f === 0) {
                            const noteValue = chord.frets[s];
                            const note = document.createElement('div');
                            note.className = 'note';
                            note.style.top = `${(s * 30) + 5}px`;
                            
                            if (noteValue === 0) {
                                note.className += ' open';
                                note.textContent = 'O';
                            } else if (noteValue === -1) {
                                note.className += ' muted';
                                note.textContent = 'X';
                            } else if (noteValue === f) {
                                note.textContent = chord.fingers[s];
                            } else {
                                note.style.visibility = 'hidden';
                            }
                            
                            fret.appendChild(note);
                        } else if (f === chord.frets[s]) {
                            const note = document.createElement('div');
                            note.className = 'note';
                            note.style.top = `${(s * 30) + 5}px`;
                            note.textContent = chord.fingers[s];
                            fret.appendChild(note);
                        }
                    }
                    
                    fretboard.appendChild(fret);
                }
            }

            // Mostrar acorde selecionado
            function showChord(chordKey) {
                const chord = chordData[chordKey];
                if (chord) {
                    chordName.textContent = chord.name;
                    generateFretboard(chord);
                    
                    // Ativar item na lista
                    document.querySelectorAll('.chord-item').forEach(item => {
                        if (item.getAttribute('data-chord') === chordKey) {
                            item.classList.add('active');
                        } else {
                            item.classList.remove('active');
                        }
                    });
                }
            }

            // Mostrar/ocultar todos os acordes
            function toggleAllChords() {
                if (showAllChordsCheckbox.checked) {
                    allChordsSection.style.display = 'block';
                    renderAllChords();
                } else {
                    allChordsSection.style.display = 'none';
                }
            }

            // Renderizar todos os acordes
            function renderAllChords() {
                allChordsGrid.innerHTML = '';
                
                // Agrupar acordes por tipo
                const categories = {
                    'major': 'Acordes Maiores',
                    'minor': 'Acordes Menores',
                    '7': 'Acordes com Sétima',
                    'm7': 'Acordes Menor Sétima',
                    'maj7': 'Acordes Maior Sétima'
                };
                
                for (const [category, title] of Object.entries(categories)) {
                    const categoryDiv = document.createElement('div');
                    categoryDiv.className = 'col-12';
                    categoryDiv.innerHTML = `<h6 class="mt-3 mb-2">${title}</h6>`;
                    allChordsGrid.appendChild(categoryDiv);
                    
                    const chordsRow = document.createElement('div');
                    chordsRow.className = 'row';
                    
                    // Filtrar acordes por categoria
                    const categoryChords = Object.entries(chordData)
                        .filter(([key]) => key.includes(category))
                        .sort(([a], [b]) => a.localeCompare(b));
                    
                    categoryChords.forEach(([key, chord]) => {
                        const chordCol = document.createElement('div');
                        chordCol.className = 'col-md-3 col-sm-4 col-6 mb-2';
                        
                        const chordButton = document.createElement('button');
                        chordButton.className = 'btn btn-outline-primary w-100';
                        chordButton.textContent = chord.name;
                        chordButton.addEventListener('click', () => showChord(key));
                        
                        chordCol.appendChild(chordButton);
                        chordsRow.appendChild(chordCol);
                    });
                    
                    allChordsGrid.appendChild(chordsRow);
                }
            }

            // Evento para o botão "Mostrar Acorde"
            showChordButton.addEventListener('click', function() {
                const root = document.getElementById('chordRoot').value;
                const type = document.getElementById('chordType').value;
                const chordKey = `${root}-${type}`;
                
                // Verificar se temos dados para este acorde
                if (chordData[chordKey]) {
                    showChord(chordKey);
                } else {
                    chordName.textContent = "Acorde não encontrado";
                    fretboard.innerHTML = '<p>Desculpe, este acorde não está disponível em nossa base de dados.</p>';
                }
            });

            // Evento para o checkbox "Mostrar todos os acordes"
            showAllChordsCheckbox.addEventListener('change', toggleAllChords);

            // Inicializar a aplicação
            initCommonChordsList();
            showChord('C-major');
        });
    </script>
</body>
</html>) ao diagrama de acordes da minha pagina, index.html = (<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- <meta name="theme-color" content="#2c3e50"> -->
    <title>Easy Strings - Aplicativo de Aprendizado Musical</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <link rel="stylesheet" href="/settings/css/style.css">
    <!-- <link rel="manifest" href="manifest.json"> -->


</head>

<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="fas fa-guitar me-2"></i>Easy Strings
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="#home">Início</a></li>
                    <li class="nav-item"><a class="nav-link" href="#fretboard">Braço</a></li>
                    <li class="nav-item"><a class="nav-link" href="#theory">Teoria</a></li>
                    <li class="nav-item"><a class="nav-link" href="#practice">Prática</a></li>
                    <li class="nav-item"><a class="nav-link" href="#games">Jogos</a></li>
                    <li class="nav-item"><a class="nav-link" href="#tools">Ferramentas</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section id="home" class="hero">
        <div class="container">
            <h1 data-aos="fade-down">Aprenda Música de Forma Interativa</h1>
            <p data-aos="fade-down" data-aos-delay="200">Explore teoria musical, pratique instrumentos e divirta-se
                aprendendo</p>
            <a href="#fretboard" class="btn btn-light btn-lg" data-aos="fade-up" data-aos-delay="400">Começar Agora</a>
        </div>
    </section>

    <!-- Fretboard Section -->
    <section id="fretboard-section" class="section">
        <div class="container">
            <h2 class="text-center mb-5" data-aos="fade-up">Braço Interativo do Instrumento</h2>

            <div class="row">
                <div class="col-lg-8">
                    <div class="fretboard" id="fretboard"></div>
                    <div class="visualizer" id="visualizer"></div>
                </div>
                <div class="col-lg-4">
                    <div class="card p-4">
                        <h4>Nota Atual</h4>
                        <p class="fs-3" id="current-note">Selecione uma nota no braço</p>

                        <h4 class="mt-4">Controles</h4>
                        <div class="controls">
                            <button id="show-notes" class="btn btn-primary">Mostrar Notas</button>
                            <button id="show-c-major" class="btn btn-secondary">Escala C Maior</button>
                            <button id="show-a-minor" class="btn btn-secondary">Acorde A Menor</button>
                            <button id="show-pentatonic" class="btn btn-secondary">Pentatônica</button>
                            <button id="clear-board" class="btn btn-outline-secondary">Limpar</button>
                            <button id="play-note" class="btn btn-success">Tocar Nota</button>
                            <button id="play-scale" class="btn btn-info">Tocar Escala</button>
                        </div>

                        <h4 class="mt-4">Instrumento</h4>
                        <div class="instrument-selector">
                            <label for="instrument-select" class="form-label">Selecionar Instrumento:</label>
                            <select class="form-select" id="instrument-select" name="instrument">
                                <option value="guitar">Violão</option>
                                <option value="bass">Baixo</option>
                                <option value="violin">Violino</option>
                                <option value="cello">Violoncelo</option>
                                <option value="ukulele">Ukulele</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Theory Section -->
    <section id="theory" class="section section-dark">
        <div class="container">
            <h2 class="text-center mb-5" data-aos="fade-up">Teoria Musical</h2>

            <div class="row">
                <div class="col-md-6" data-aos="fade-right">
                    <div class="quiz-container">
                        <h4>Quiz: Quantas notas tem uma escala maior?</h4>

                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="quiz-answer" id="quiz-option-1"
                                value="5">
                            <label class="form-check-label" for="quiz-option-1">5 notas</label>
                        </div>

                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="quiz-answer" id="quiz-option-2"
                                value="7">
                            <label class="form-check-label" for="quiz-option-2">7 notas</label>
                        </div>

                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="quiz-answer" id="quiz-option-3"
                                value="12">
                            <label class="form-check-label" for="quiz-option-3">12 notas</label>
                        </div>

                        <button id="quiz-submit" class="btn btn-primary mt-3">Verificar Resposta</button>

                        <div id="quiz-feedback" class="mt-3"></div>
                    </div>
                </div>

                <div class="col-md-6" data-aos="fade-left">
                    <div class="card p-4 h-100">
                        <h4>Círculo de Quintas</h4>
                        <div class="circle-of-fifths">
                            <div class="tone-circle"></div>
                        </div>
                        <p class="mt-3 text-center">Clique em uma nota para ver sua armadura de clave</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Adicionar após a seção de teoria -->
    <section id="lessons" class="section">
        <div class="container">
            <h2 class="text-center mb-5" data-aos="fade-up">Lições Estruturadas</h2>

            <div class="row">
                <div class="col-lg-4 mb-4" data-aos="fade-up" data-aos-delay="100">
                    <div class="card h-100">
                        <div class="card-body">
                            <div class="text-center mb-3">
                                <span class="feature-icon"><i class="fas fa-guitar"></i></span>
                            </div>
                            <h4 class="card-title">Módulo 1: Introdução</h4>
                            <p class="card-text">Aprenda os fundamentos da música, notas, e como ler partituras básicas.
                            </p>
                            <ul class="list-group list-group-flush">
                                <li class="list-group-item">Conhecendo o braço do instrumento</li>
                                <li class="list-group-item">Notas musicais e suas posições</li>
                                <li class="list-group-item">Ritmo básico e contagem de tempos</li>
                            </ul>
                            <div class="text-center mt-3">
                                <button class="btn btn-primary">Iniciar Módulo</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-lg-4 mb-4" data-aos="fade-up" data-aos-delay="200">
                    <div class="card h-100">
                        <div class="card-body">
                            <div class="text-center mb-3">
                                <span class="feature-icon"><i class="fas fa-music"></i></span>
                            </div>
                            <h4 class="card-title">Módulo 2: Escalas e Acordes</h4>
                            <p class="card-text">Domine as escalas principais e aprenda a formar acordes básicos.</p>
                            <ul class="list-group list-group-flush">
                                <li class="list-group-item">Escala maior e menor</li>
                                <li class="list-group-item">Acordes maiores e menores</li>
                                <li class="list-group-item">Progressões de acordes comuns</li>
                            </ul>
                            <div class="text-center mt-3">
                                <button class="btn btn-primary">Iniciar Módulo</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-lg-4 mb-4" data-aos="fade-up" data-aos-delay="300">
                    <div class="card h-100">
                        <div class="card-body">
                            <div class="text-center mb-3">
                                <span class="feature-icon"><i class="fas fa-sliders-h"></i></span>
                            </div>
                            <h4 class="card-title">Módulo 3: Técnicas Avançadas</h4>
                            <p class="card-text">Aprimore sua técnica com exercícios avançados e conceitos musicais
                                complexos.</p>
                            <ul class="list-group list-group-flush">
                                <li class="list-group-item">Improvisação e solo</li>
                                <li class="list-group-item">Harmonia e contraponto</li>
                                <li class="list-group-item">Leitura musical avançada</li>
                            </ul>
                            <div class="text-center mt-3">
                                <button class="btn btn-primary">Iniciar Módulo</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="text-center mt-5">
                <button class="btn btn-outline-primary">Ver Todos os Módulos</button>
            </div>
        </div>
    </section>

    <!-- Seção de vídeos educativos -->
    <section id="videos" class="section section-dark">
        <div class="container">
            <h2 class="text-center mb-5" data-aos="fade-up">Demonstrações em Vídeo</h2>

            <div class="row">
                <div class="col-md-6 mb-4" data-aos="fade-right">
                    <div class="ratio ratio-16x9">
                        <iframe src="https://www.youtube.com/embed/jhYGXKqeb4I" title="Introdução ao Braço da Guitarra"
                            allowfullscreen></iframe>
                    </div>
                    <h4 class="mt-3">Introdução ao Braço da Guitarra</h4>
                    <p>Aprenda as partes do braço, nomes das cordas e como localizar notas.</p>
                </div>

                <div class="col-md-6 mb-4" data-aos="fade-left">
                    <div class="ratio ratio-16x9">
                        <iframe src="https://www.youtube.com/embed/rgaTLrZGlk0"
                            title="Primeiros Acordes para Iniciantes" allowfullscreen></iframe>
                    </div>
                    <h4 class="mt-3">Primeiros Acordes para Iniciantes</h4>
                    <p>Domine os acordes básicos e comece a tocar suas primeiras músicas.</p>
                </div>
            </div>

            <div class="text-center mt-4">
                <button class="btn btn-light">Mais Vídeos Educativos</button>
            </div>
        </div>
    </section>

    <!-- Practice Section -->
    <section id="practice" class="section">
        <div class="container">
            <h2 class="text-center mb-5" data-aos="fade-up">Pratique e Treine</h2>

            <div class="row">
                <div class="col-lg-6" data-aos="fade-right">
                    <div class="card p-4 h-100">
                        <h4>Metrônomo</h4>
                        <div class="metronome-controls">
                            <div class="mb-3">
                                <label for="bpm-slider" class="form-label">Velocidade (BPM): <span
                                        id="bpm-display">120</span></label>
                                <input type="range" class="form-range" id="bpm-slider" name="bpm" min="40" max="240"
                                    value="120" aria-describedby="bpm-help">
                                <div id="bpm-help" class="form-text">Ajuste a velocidade do metrônomo</div>
                            </div>

                            <button id="metronome-toggle" class="btn btn-primary">
                                <i class="fas fa-play me-2"></i>Iniciar
                            </button>
                        </div>
                    </div>
                </div>

                <div class="col-lg-6" data-aos="fade-left">
                    <div class="card p-4 h-100">
                        <h4>Treino Rítmico</h4>
                        <div class="rhythm-grid" id="rhythm-grid"></div>
                        <div class="d-flex gap-2 mt-3">
                            <button id="play-rhythm" class="btn btn-primary flex-grow-1">Reproduzir Ritmo</button>
                            <button id="clear-rhythm" class="btn btn-outline-secondary">Limpar</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row mt-5">
                <div class="col-lg-6" data-aos="fade-right">
                    <div class="card p-4 h-100">
                        <h4>Sequência de Notas</h4>
                        <p>Memorize e reproduza a sequência:</p>
                        <div class="sequence-container">
                            <div class="sequence-note" data-note="C">C</div>
                            <div class="sequence-note" data-note="D">D</div>
                            <div class="sequence-note" data-note="E">E</div>
                            <div class="sequence-note" data-note="F">F</div>
                            <div class="sequence-note" data-note="G">G</div>
                            <div class="sequence-note" data-note="A">A</div>
                            <div class="sequence-note" data-note="B">B</div>
                        </div>
                        <p class="mt-3">Sequência: <span id="current-sequence"></span></p>
                        <div class="d-flex gap-2">
                            <button id="play-sequence" class="btn btn-primary flex-grow-1">Nova Sequência</button>
                            <button id="repeat-sequence" class="btn btn-outline-secondary">Repetir</button>
                        </div>
                    </div>
                </div>

                <div class="col-lg-6" data-aos="fade-left">
                    <div class="card p-4 h-100">
                        <h4>Treino de Intervalos</h4>
                        <p>Ouça e identifique o intervalo:</p>
                        <button id="play-interval" class="btn btn-primary w-100 mb-3">Reproduzir Intervalo</button>

                        <div class="game-options">
                            <div class="row">
                                <div class="col-6 mb-2">
                                    <div class="game-option btn btn-outline-primary w-100" data-interval="2M">2ª Maior
                                    </div>
                                </div>
                                <div class="col-6 mb-2">
                                    <div class="game-option btn btn-outline-primary w-100" data-interval="3m">3ª Menor
                                    </div>
                                </div>
                                <div class="col-6 mb-2">
                                    <div class="game-option btn btn-outline-primary w-100" data-interval="5P">5ª Justa
                                    </div>
                                </div>
                                <div class="col-6 mb-2">
                                    <div class="game-option btn btn-outline-primary w-100" data-interval="7m">7ª Menor
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="mt-3">
                            <span>Pontuação: </span>
                            <span id="interval-game-score">0</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Games Section -->
    <section id="games" class="section section-dark">
        <div class="container">
            <h2 class="text-center mb-5" data-aos="fade-up">Jogos Musicais</h2>

            <div class="row">
                <div class="col-lg-6" data-aos="fade-right">
                    <div class="card p-4 h-100">
                        <h4>Identificação de Notas</h4>
                        <p>Encontre esta nota no braço do instrumento:</p>
                        <h3 class="text-center my-4" id="note-to-find">C</h3>
                        <button id="new-note" class="btn btn-primary w-100">Nova Nota</button>
                        <div class="mt-3">
                            <span>Pontuação: </span>
                            <span id="note-game-score">0</span>
                        </div>
                    </div>
                </div>

                <div class="col-lg-6" data-aos="fade-left">
                    <div class="card p-4 h-100">
                        <h4>Diagrama de Acordes</h4>
                        <div class="chord-diagram" id="chord-diagram"></div>
                        <div class="row mt-3">
                            <div class="col-8">
                                <div class="chord-selector">
                                    <label for="chord-select" class="form-label">Selecionar Acorde:</label>
                                    <select class="form-select" id="chord-select" name="chord">
                                        <option value="C">C Maior</option>
                                        <option value="Cm">C Menor</option>
                                        <option value="C7">C7</option>
                                        <option value="Cmaj7">Cmaj7</option>
                                        <option value="G">G Maior</option>
                                        <option value="D">D Maior</option>
                                        <option value="A">A Maior</option>
                                        <option value="E">E Maior</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-4">
                                <button id="play-chord" class="btn btn-primary w-100">Tocar</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Tools Section -->
    <section id="tools" class="section">
        <div class="container">
            <h2 class="text-center mb-5" data-aos="fade-up">Ferramentas Úteis</h2>

            <div class="row">
                <div class="col-lg-6" data-aos="fade-right">
                    <div class="card p-4 h-100">
                        <div class="progression-controls">
                            <div class="row">
                                <div class="col-md-6">
                                    <label for="progression-style" class="form-label">Estilo:</label>
                                    <select class="form-select" id="progression-style" name="progression_style">
                                        <option value="pop">Pop</option>
                                        <option value="rock">Rock</option>
                                        <option value="jazz">Jazz</option>
                                        <option value="blues">Blues</option>
                                        <option value="classical">Clássico</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label for="progression-length" class="form-label">Comprimento:</label>
                                    <select class="form-select" id="progression-length" name="progression_length">
                                        <option value="4">4 acordes</option>
                                        <option value="8">8 acordes</option>
                                        <option value="12">12 acordes</option>
                                        <option value="16">16 acordes</option>
                                    </select>
                                </div>
                            </div>

                            <button id="generate-progression" class="btn btn-primary mt-3">
                                <i class="fas fa-random me-2"></i>Gerar Progressão
                            </button>
                        </div>
                    </div>
                </div>

                <div class="col-lg-6" data-aos="fade-left">
                    <div class="card p-4 h-100">
                        <h4>Referência de Afinação</h4>
                        <p>Clique para ouvir as notas de referência:</p>
                        <div class="tuning-reference">
                            <button class="btn btn-outline-primary interactive-btn" data-note="E2">E₂</button>
                            <button class="btn btn-outline-primary interactive-btn" data-note="A2">A₂</button>
                            <button class="btn btn-outline-primary interactive-btn" data-note="D3">D₃</button>
                            <button class="btn btn-outline-primary interactive-btn" data-note="G3">G₃</button>
                            <button class="btn btn-outline-primary interactive-btn" data-note="B3">B₃</button>
                            <button class="btn btn-outline-primary interactive-btn" data-note="E4">E₄</button>
                        </div>
                        <div class="mt-4">
                            <h5>Dicas de Afinação:</h5>
                            <ul>
                                <li>Use um ambiente silencioso</li>
                                <li>Afine de baixo para cima</li>
                                <li>Verifique a afinação regularmente</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="row">
                <div class="col-md-4 mb-4">
                    <h5>Easy Strings</h5>
                    <p>Aprenda música de forma interativa e divertida.</p>
                </div>
                <div class="col-md-4 mb-4">
                    <h5>Links Rápidos</h5>
                    <ul class="list-unstyled">
                        <li><a href="#home" class="text-white">Início</a></li>
                        <li><a href="#fretboard" class="text-white">Braço Interativo</a></li>
                        <li><a href="#theory" class="text-white">Teoria Musical</a></li>
                        <li><a href="#practice" class="text-white">Prática</a></li>
                    </ul>
                </div>
                <div class="col-md-4 mb-4">
                    <h5>Conecte-se</h5>
                    <div class="social-links">
                        <a href="#"><i class="fab fa-facebook"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-youtube"></i></a>
                    </div>
                </div>
            </div>
            <hr class="bg-light">
            <p class="text-center mb-0">&copy; 2025 Easy Strings. Todos os direitos reservados a Nilson Gomes.</p>
        </div>
    </footer>

    <!-- Back to Top Button -->
    <a href="#" class="back-to-top">
        <i class="fas fa-arrow-up"></i>
    </a>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

    <script src="/settings/js/script.js"></script>
</body>

</html>) script.js = (// =============================================================================
// CONFIGURAÇÃO E INICIALIZAÇÃO
// =============================================================================

// Constantes para configuração
const CONFIG = {
    DEFAULT_BPM: 120,
    DEFAULT_INSTRUMENT: 'guitar',
    NOTE_FREQUENCIES: {
        'C': 261.63, 'C#': 277.18, 'D': 293.66, 'D#': 311.13,
        'E': 329.63, 'F': 349.23, 'F#': 369.99, 'G': 392.00,
        'G#': 415.30, 'A': 440.00, 'A#': 466.16, 'B': 493.88
    },
    INSTRUMENT_TUNINGS: {
        guitar: ['E', 'A', 'D', 'G', 'B', 'E'],
        bass: ['E', 'A', 'D', 'G'],
        violin: ['G', 'D', 'A', 'E'],
        cello: ['C', 'G', 'D', 'A'],
        ukulele: ['G', 'C', 'E', 'A']
    },
    SCALES: {
        'C major': ['C', 'D', 'E', 'F', 'G', 'A', 'B'],
        'A minor': ['A', 'C', 'E'],
        'A minor pentatonic': ['A', 'C', 'D', 'E', 'G']
    },
    INTERVALS: {
        '2M': { name: '2ª Maior', freqs: [261.63, 293.66] },
        '3m': { name: '3ª Menor', freqs: [261.63, 311.13] },
        '5P': { name: '5ª Justa', freqs: [261.63, 392.00] },
        '7m': { name: '7ª Menor', freqs: [261.63, 466.16] }
    }
};

// Estado da aplicação
const AppState = {
    audioContext: null,
    currentInstrument: CONFIG.DEFAULT_INSTRUMENT,
    metronome: {
        isPlaying: false,
        intervalId: null
    },
    games: {
        noteIdentification: {
            score: 0,
            currentNote: ''
        },
        intervalTraining: {
            score: 0,
            currentInterval: ''
        },
        noteSequence: {
            currentSequence: [],
            userSequence: [],
            isPlaying: false
        }
    }
};

// Inicialização quando o DOM estiver pronto
document.addEventListener('DOMContentLoaded', initApp);

function initApp() {
    // Inicializar AOS para animações de scroll se disponível
    if (typeof AOS !== 'undefined') {
        AOS.init({
            duration: 800,
            easing: 'ease-in-out',
            once: true
        });
    }

    // Configurar todos os módulos apenas se os elementos existirem
    try {
        if (document.getElementById('fretboard')) setupFretboard();
        if (document.querySelector('.back-to-top')) setupBackToTop();
        if (document.querySelector('.quiz-option')) setupQuiz();
        if (document.getElementById('metronome-toggle')) setupMetronome();
        if (document.querySelector('.instrument-btn')) setupInstrumentSelector();
        if (document.getElementById('rhythm-grid')) setupRhythmGrid();
        if (document.querySelector('.tone-circle')) setupCircleOfFifths();
        if (document.querySelector('.sequence-note')) setupNoteSequence();
        if (document.querySelector('.game-option')) setupIntervalTraining();
        if (document.getElementById('chord-select')) setupChordDiagram();
        if (document.getElementById('generate-progression')) setupProgressionGenerator();
        
        // Inicializar jogos
        if (document.getElementById('new-note')) setupNoteIdentificationGame();
        if (document.querySelector('.tuning-container')) setupTuningReferences();
        
        // Adicionar event listeners para tocar notas no braço
        document.querySelectorAll('.note').forEach(note => {
            note.addEventListener('click', function() {
                const frequency = parseFloat(this.dataset.frequency);
                if (!isNaN(frequency)) {
                    playTone(frequency, 0.5);
                }
            });
        });
    } catch (error) {
        console.error('Erro na inicialização:', error);
    }
}

// =============================================================================
// MÓDULO DE ÁUDIO
// =============================================================================

function getAudioContext() {
    if (!AppState.audioContext) {
        AppState.audioContext = new (window.AudioContext || window.webkitAudioContext)();
    }
    return AppState.audioContext;
}

function playTone(frequency, duration, type = 'sine', volume = 0.3) {
    const audioContext = getAudioContext();
    const oscillator = audioContext.createOscillator();
    const gainNode = audioContext.createGain();

    oscillator.type = type;
    oscillator.frequency.value = frequency;
    gainNode.gain.value = volume;

    oscillator.connect(gainNode);
    gainNode.connect(audioContext.destination);

    oscillator.start();
    gainNode.gain.exponentialRampToValueAtTime(0.00001, audioContext.currentTime + duration);

    setTimeout(() => {
        oscillator.stop();
    }, duration * 1000);

    return oscillator;
}

function playMetronomeClick() {
    const audioContext = getAudioContext();
    const oscillator = audioContext.createOscillator();
    const gainNode = audioContext.createGain();

    oscillator.type = 'sine';
    oscillator.frequency.value = 1000;
    gainNode.gain.value = 0.1;

    oscillator.connect(gainNode);
    gainNode.connect(audioContext.destination);

    oscillator.start();
    gainNode.gain.exponentialRampToValueAtTime(0.00001, audioContext.currentTime + 0.05);

    setTimeout(() => {
        oscillator.stop();
    }, 50);

    // Feedback visual
    const toggleButton = document.getElementById('metronome-toggle');
    if (toggleButton) {
        toggleButton.classList.add('btn-danger');
        setTimeout(() => {
            toggleButton.classList.remove('btn-danger');
        }, 100);
    }
}

// =============================================================================
// MÓDULO DO BRAÇO (FRETBOARD)
// =============================================================================

function setupFretboard() {
    generateFretboard();

    // Configurar eventos dos botões
    const showNotesBtn = document.getElementById('show-notes');
    const showCMajorBtn = document.getElementById('show-c-major');
    const showAMinorBtn = document.getElementById('show-a-minor');
    const showPentatonicBtn = document.getElementById('show-pentatonic');
    const clearBoardBtn = document.getElementById('clear-board');
    const playNoteBtn = document.getElementById('play-note');
    const playScaleBtn = document.getElementById('play-scale');

    if (showNotesBtn) showNotesBtn.addEventListener('click', toggleAllNotes);
    if (showCMajorBtn) showCMajorBtn.addEventListener('click', () => showScale('C major'));
    if (showAMinorBtn) showAMinorBtn.addEventListener('click', () => showChord('A minor'));
    if (showPentatonicBtn) showPentatonicBtn.addEventListener('click', () => showScale('A minor pentatonic'));
    if (clearBoardBtn) clearBoardBtn.addEventListener('click', clearFretboard);
    if (playNoteBtn) playNoteBtn.addEventListener('click', playCurrentNote);
    if (playScaleBtn) playScaleBtn.addEventListener('click', playCurrentScale);
}

function generateFretboard() {
    const fretboard = document.getElementById('fretboard');
    if (!fretboard) return;
    
    fretboard.innerHTML = '';

    const strings = CONFIG.INSTRUMENT_TUNINGS[AppState.currentInstrument].length;
    const frets = 13; // 12 trastes + corda solta

    const openNotes = CONFIG.INSTRUMENT_TUNINGS[AppState.currentInstrument];
    const stringNames = [...openNotes].reverse(); // Inverter para exibição padrão (cordas graves em baixo)

    for (let i = 0; i < strings; i++) {
        const stringElement = document.createElement('div');
        stringElement.className = 'string';

        // Adicionar nome da corda
        const stringName = document.createElement('div');
        stringName.className = 'string-name';
        stringName.textContent = stringNames[i];
        stringElement.appendChild(stringName);

        for (let j = 0; j < frets; j++) {
            const fretElement = document.createElement('div');
            fretElement.className = 'fret';
            fretElement.dataset.string = i;
            fretElement.dataset.fret = j;

            // Adicionar marcadores de traste
            if (j === 3 || j === 5 || j === 7 || j === 9 || j === 15 || j === 17) {
                const fretMarker = document.createElement('div');
                fretMarker.className = 'fret-marker';
                fretElement.appendChild(fretMarker);
            }
            if (j === 12) {
                const fretMarker = document.createElement('div');
                fretMarker.className = 'fret-marker';
                const fretMarker2 = document.createElement('div');
                fretMarker2.className = 'fret-marker';
                fretMarker2.style.top = '60%';
                fretElement.appendChild(fretMarker);
                fretElement.appendChild(fretMarker2);
            }

            // Adicionar indicador de nota
            const noteElement = document.createElement('div');
            noteElement.className = 'note';
            noteElement.style.visibility = 'hidden'; // Oculto por padrão

            // Calcular nota com base na corda e posição do traste
            const note = calculateNote(openNotes[i], j);
            noteElement.textContent = note;
            noteElement.dataset.note = note;
            noteElement.dataset.frequency = calculateFrequency(note, j);

            // Adicionar evento de clique para mostrar informações da nota
            noteElement.addEventListener('click', handleNoteClick);

            fretElement.appendChild(noteElement);
            stringElement.appendChild(fretElement);
        }

        fretboard.appendChild(stringElement);
    }
}

function calculateNote(openNote, fret) {
    const notes = Object.keys(CONFIG.NOTE_FREQUENCIES);
    const openIndex = notes.indexOf(openNote);
    const noteIndex = (openIndex + fret) % 12;
    return notes[noteIndex];
}

function calculateFrequency(note, fret) {
    const baseFrequency = CONFIG.NOTE_FREQUENCIES[note.replace(/\d/g, '')];
    const octave = 4 + Math.floor(fret / 12);
    return baseFrequency * Math.pow(2, octave - 4);
}

function handleNoteClick() {
    const currentNoteElement = document.getElementById('current-note');
    if (currentNoteElement) {
        currentNoteElement.textContent = `Nota: ${this.dataset.note}`;
    }

    // Remover classe ativa de todas as notas
    document.querySelectorAll('.note.active').forEach(note => {
        note.classList.remove('active');
    });

    // Adicionar classe ativa à nota clicada
    this.classList.add('active');

    // Tocar a nota
    const frequency = parseFloat(this.dataset.frequency);
    if (!isNaN(frequency)) {
        playTone(frequency, 0.5);
    }
}

function toggleAllNotes() {
    const notes = document.querySelectorAll('.note');
    if (notes.length === 0) return;
    
    const isVisible = notes[0].style.visibility === 'visible';

    notes.forEach(note => {
        note.style.visibility = isVisible ? 'hidden' : 'visible';
    });
}

function showScale(scaleName) {
    const scaleNotes = CONFIG.SCALES[scaleName];
    if (scaleNotes) {
        highlightNotes(scaleNotes);
    }
}

function showChord(chordName) {
    const chordNotes = CONFIG.SCALES[chordName];
    if (chordNotes) {
        highlightNotes(chordNotes, true);
    }
}

function clearFretboard() {
    const notes = document.querySelectorAll('.note');
    notes.forEach(note => {
        note.classList.remove('active');
        note.classList.remove('root');
    });
}

function highlightNotes(notesToHighlight, markRoot = false) {
    clearFretboard();

    const allNotes = document.querySelectorAll('.note');
    allNotes.forEach(note => {
        if (notesToHighlight.includes(note.dataset.note)) {
            note.style.visibility = 'visible';
            note.classList.add('active');

            // Marcar nota raiz se especificado
            if (markRoot && note.dataset.note === notesToHighlight[0]) {
                note.classList.add('root');
            }
        }
    });
}

function playCurrentNote() {
    const activeNote = document.querySelector('.note.active');
    if (activeNote) {
        const frequency = parseFloat(activeNote.dataset.frequency);
        if (!isNaN(frequency)) {
            playTone(frequency, 0.5);
            simulateAudioVisualization();
        }
    } else {
        alert("Por favor, selecione uma nota no braço primeiro.");
    }
}

function playCurrentScale() {
    const activeNotes = document.querySelectorAll('.note.active');
    if (activeNotes.length > 0) {
        // Ordenar notas por corda e traste para tocar em ordem
        const sortedNotes = Array.from(activeNotes).sort((a, b) => {
            const aString = parseInt(a.parentElement.dataset.string);
            const bString = parseInt(b.parentElement.dataset.string);
            const aFret = parseInt(a.parentElement.dataset.fret);
            const bFret = parseInt(b.parentElement.dataset.fret);

            if (aString !== bString) return aString - bString;
            return aFret - bFret;
        });

        // Tocar cada nota com um atraso
        sortedNotes.forEach((note, index) => {
            setTimeout(() => {
                const frequency = parseFloat(note.dataset.frequency);
                if (!isNaN(frequency)) {
                    playTone(frequency, 0.3);
                    note.classList.add('note-playing');
                    setTimeout(() => note.classList.remove('note-playing'), 300);
                }
            }, index * 500);
        });

        simulateAudioVisualization();
    } else {
        alert("Por favor, selecione algumas notas no braço primeiro.");
    }
}

function simulateAudioVisualization() {
    const visualizer = document.getElementById('visualizer');
    if (!visualizer) return;
    
    visualizer.innerHTML = '';

    for (let i = 0; i < 50; i++) {
        const bar = document.createElement('div');
        bar.className = 'visualizer-bar';
        bar.style.left = (i * 8) + 'px';
        bar.style.height = (Math.random() * 80 + 20) + 'px';
        visualizer.appendChild(bar);
    }

    // Limpar visualização após 3 segundos
    setTimeout(() => {
        if (visualizer) {
            visualizer.innerHTML = '';
        }
    }, 3000);
}

// =============================================================================
// MÓDULO DE NAVEGAÇÃO
// =============================================================================

function setupBackToTop() {
    const backToTopButton = document.querySelector('.back-to-top');
    if (!backToTopButton) return;

    window.addEventListener('scroll', function () {
        if (window.pageYOffset > 300) {
            backToTopButton.style.display = 'flex';
        } else {
            backToTopButton.style.display = 'none';
        }
    });

    backToTopButton.addEventListener('click', function (e) {
        e.preventDefault();
        window.scrollTo({ top: 0, behavior: 'smooth' });
    });
}

// =============================================================================
// MÓDULO DE QUIZ
// =============================================================================

function setupQuiz() {
    const options = document.querySelectorAll('.form-check-input');
    const submitButton = document.getElementById('quiz-submit');
    
    if (!options.length || !submitButton) return;
    
    options.forEach(option => {
        option.addEventListener('change', function() {
            options.forEach(opt => opt.parentElement.classList.remove('selected'));
            if (this.checked) {
                this.parentElement.classList.add('selected');
            }
        });
    });

    submitButton.addEventListener('click', function() {
        const selected = document.querySelector('.form-check-input:checked');
        const feedback = document.getElementById('quiz-feedback');

        if (feedback) {
            if (selected) {
                if (selected.value === '7') {
                    feedback.innerHTML = '<div class="alert alert-success">Resposta correta! Uma escala maior possui 7 notas.</div>';
                } else {
                    feedback.innerHTML = '<div class="alert alert-danger">Resposta incorreta. Tente novamente.</div>';
                }
            } else {
                feedback.innerHTML = '<div class="alert alert-warning">Por favor, selecione uma resposta.</div>';
            }
        }
    });
}

// =============================================================================
// MÓDULO DO METRÔNOMO
// =============================================================================

function setupMetronome() {
    const bpmSlider = document.getElementById('bpm-slider');
    const bpmDisplay = document.getElementById('bpm-display');
    const toggleButton = document.getElementById('metronome-toggle');
    
    if (!bpmSlider || !bpmDisplay || !toggleButton) return;

    bpmSlider.addEventListener('input', function() {
        bpmDisplay.textContent = `${this.value} BPM`;
        if (AppState.metronome.isPlaying) {
            clearInterval(AppState.metronome.intervalId);
            startMetronome(this.value);
        }
    });

    toggleButton.addEventListener('click', function () {
        if (AppState.metronome.isPlaying) {
            // Parar metrônomo
            clearInterval(AppState.metronome.intervalId);
            toggleButton.innerHTML = '<i class="fas fa-play me-2"></i>Iniciar';
            AppState.metronome.isPlaying = false;
        } else {
            // Iniciar metrônomo
            startMetronome(bpmSlider.value);
            toggleButton.innerHTML = '<i class="fas fa-stop me-2"></i>Parar';
            AppState.metronome.isPlaying = true;
        }
    });

    function startMetronome(bpm) {
        const interval = 60000 / bpm; // Converter BPM para milissegundos
        AppState.metronome.intervalId = setInterval(function () {
            playMetronomeClick();
        }, interval);
    }
}

// =============================================================================
// MÓDULO DE SELEÇÃO DE INSTRUMENTO
// =============================================================================

function setupInstrumentSelector() {
    const instrumentSelect = document.getElementById('instrument-select');
    const instrumentButtons = document.querySelectorAll('.instrument-btn');
    
    if (instrumentSelect) {
        instrumentSelect.addEventListener('change', function() {
            const instrument = this.value;
            changeInstrument(instrument);
        });
    }

    // Adicione também os botões visuais se ainda quiser mantê-los
    if (instrumentButtons.length) {
        instrumentButtons.forEach(button => {
            button.addEventListener('click', function() {
                instrumentButtons.forEach(btn => btn.classList.remove('active'));
                this.classList.add('active');
                const instrument = this.dataset.instrument;
                changeInstrument(instrument);
                // Sincronize com o select
                if (instrumentSelect) {
                    instrumentSelect.value = instrument;
                }
            });
        });
    }
}

function changeInstrument(instrument) {
    AppState.currentInstrument = instrument;
    generateFretboard();
}

// =============================================================================
// MÓDULO DE GRADE RÍTMICA
// =============================================================================

function setupRhythmGrid() {
    const rhythmGrid = document.getElementById('rhythm-grid');
    const playRhythmBtn = document.getElementById('play-rhythm');
    const clearRhythmBtn = document.getElementById('clear-rhythm');
    
    if (!rhythmGrid || !playRhythmBtn || !clearRhythmBtn) return;
    
    rhythmGrid.innerHTML = '';

    // Criar 16 células para a grade rítmica
    for (let i = 0; i < 16; i++) {
        const cell = document.createElement('div');
        cell.className = 'rhythm-cell';
        if (i % 4 === 0) {
            cell.classList.add('beat');
        }

        cell.addEventListener('click', function () {
            this.classList.toggle('active');
        });

        rhythmGrid.appendChild(cell);
    }

    // Configurar botão de reproduzir ritmo
    playRhythmBtn.addEventListener('click', playRhythmPattern);

    // Configurar botão de limpar ritmo
    clearRhythmBtn.addEventListener('click', clearRhythmPattern);
}

function playRhythmPattern() {
    const activeCells = document.querySelectorAll('.rhythm-cell.active');
    if (activeCells.length === 0) {
        alert("Por favor, crie um padrão rítmico clicando nas células.");
        return;
    }

    const bpmSlider = document.getElementById('bpm-slider');
    const bpm = bpmSlider ? parseInt(bpmSlider.value) : 120;
    const interval = 60000 / bpm / 4; // Intervalo de semicolcheia

    activeCells.forEach((cell, index) => {
        setTimeout(() => {
            cell.classList.add('note-playing');
            playMetronomeClick();
            setTimeout(() => cell.classList.remove('note-playing'), interval / 2);
        }, index * interval);
    });
}

function clearRhythmPattern() {
    const activeCells = document.querySelectorAll('.rhythm-cell.active');
    activeCells.forEach(cell => {
        cell.classList.remove('active');
    });
}

// =============================================================================
// MÓDULO DO CÍRCULO DE QUINTAS
// =============================================================================

function setupCircleOfFifths() {
    const circle = document.querySelector('.tone-circle');
    if (!circle) return;
    
    const notes = ['C', 'G', 'D', 'A', 'E', 'B', 'F#', 'Gb', 'C#', 'Db', 'G#', 'Ab', 'D#', 'Eb', 'A#', 'Bb', 'F'];

    // Position notes around the circle
    notes.forEach((note, index) => {
        const angle = (index * 30) * (Math.PI / 180); // Convert to radians
        const radius = 120; // Distance from center

        const noteElement = document.createElement('div');
        noteElement.className = 'circle-note';
        noteElement.textContent = note;
        noteElement.style.left = `calc(50% + ${radius * Math.cos(angle)}px)`;
        noteElement.style.top = `calc(50% + ${radius * Math.sin(angle)}px)`;
        noteElement.dataset.note = note;

        noteElement.addEventListener('click', function () {
            showKeySignatureAndScales(note);
        });

        circle.appendChild(noteElement);
    });

    // Função para mostrar a armadura de clave e escalas relacionadas
    function showKeySignatureAndScales(note) {
        // Mapeamento de notas para armaduras de clave
        const keySignatures = {
            'C': { major: 'C Maior', sharps: 0, flats: 0, relativeMinor: 'Am' },
            'G': { major: 'G Maior', sharps: 1, flats: 0, relativeMinor: 'Em' },
            'D': { major: 'D Maior', sharps: 2, flats: 0, relativeMinor: 'Bm' },
            'A': { major: 'A Maior', sharps: 3, flats: 0, relativeMinor: 'F#m' },
            'E': { major: 'E Maior', sharps: 4, flats: 0, relativeMinor: 'C#m' },
            'B': { major: 'B Maior', sharps: 5, flats: 0, relativeMinor: 'G#m' },
            'F#': { major: 'F# Maior', sharps: 6, flats: 0, relativeMinor: 'D#m' },
            'C#': { major: 'C# Maior', sharps: 7, flats: 0, relativeMinor: 'A#m' },
            'F': { major: 'F Maior', sharps: 0, flats: 1, relativeMinor: 'Dm' },
            'Bb': { major: 'Bb Maior', sharps: 0, flats: 2, relativeMinor: 'Gm' },
            'Eb': { major: 'Eb Maior', sharps: 0, flats: 3, relativeMinor: 'Cm' },
            'Ab': { major: 'Ab Maior', sharps: 0, flats: 4, relativeMinor: 'Fm' },
            'Db': { major: 'Db Maior', sharps: 0, flats: 5, relativeMinor: 'Bbm' },
            'Gb': { major: 'Gb Maior', sharps: 0, flats: 6, relativeMinor: 'Ebm' },
            'Cb': { major: 'Cb Maior', sharps: 0, flats: 7, relativeMinor: 'Abm' }
        };

        // Verificar se a nota existe no mapeamento
        if (!keySignatures[note]) {
            alert(`Nota ${note} selecionada. Informações não disponíveis.`);
            return;
        }

        const keyInfo = keySignatures[note];

        // Criar conteúdo informativo
        let infoContent = `
        <h4>${keyInfo.major}</h4>
        <p><strong>Armadura de Clave:</strong> `;

        if (keyInfo.sharps > 0) {
            infoContent += `${keyInfo.sharps} sustenido(s)`;
        } else if (keyInfo.flats > 0) {
            infoContent += `${keyInfo.flats} bemol(is)`;
        } else {
            infoContent += "Nenhum acidente";
        }

        infoContent += `</p>
        <p><strong>Menor Relativa:</strong> ${keyInfo.relativeMinor}</p>
        <h5>Escala Maior:</h5>
        <p>${getMajorScale(note)}</p>
        <h5>Escala Menor Natural:</h5>
        <p>${getNaturalMinorScale(note)}</p>
        <h5>Acordes da Tonalidade:</h5>
        <p>${getChordsInKey(note)}</p>
    `;

        // Criar ou atualizar modal de informações
        let infoModal = document.getElementById('circle-of-fifths-modal');
        if (!infoModal) {
            infoModal = document.createElement('div');
            infoModal.id = 'circle-of-fifths-modal';
            infoModal.style.cssText = `
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 25px rgba(0,0,0,0.3);
            z-index: 1050;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
        `;

            const closeButton = document.createElement('button');
            closeButton.textContent = 'Fechar';
            closeButton.style.cssText = `
            margin-top: 15px;
            padding: 8px 16px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        `;
            closeButton.onclick = function () {
                document.body.removeChild(infoModal);
                const overlay = document.getElementById('modal-overlay');
                if (overlay) document.body.removeChild(overlay);
            };

            infoModal.appendChild(closeButton);
            document.body.appendChild(infoModal);
        }

        infoModal.innerHTML = infoContent;

        // Adicionar botão de fechar
        const closeButton = document.createElement('button');
        closeButton.textContent = 'Fechar';
        closeButton.style.cssText = `
        margin-top: 15px;
        padding: 8px 16px;
        background: var(--primary);
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
    `;
        closeButton.onclick = function () {
            document.body.removeChild(infoModal);
            const overlay = document.getElementById('modal-overlay');
            if (overlay) document.body.removeChild(overlay);
        };
        infoModal.appendChild(closeButton);

        // Adicionar overlay escuro
        let overlay = document.getElementById('modal-overlay');
        if (!overlay) {
            overlay = document.createElement('div');
            overlay.id = 'modal-overlay';
            overlay.style.cssText = `
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1040;
        `;
            overlay.onclick = function () {
                document.body.removeChild(infoModal);
                document.body.removeChild(overlay);
            };
            document.body.appendChild(overlay);
        }
    }

    // Função para obter a escala maior
    function getMajorScale(tonic) {
        const scalePattern = [0, 2, 4, 5, 7, 9, 11]; // T-T-S-T-T-T-S
        const notes = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];

        const tonicIndex = notes.indexOf(tonic);
        if (tonicIndex === -1) return "Não disponível";

        const scale = scalePattern.map(interval =>
            notes[(tonicIndex + interval) % 12]
        );

        return scale.join(' - ');
    }

    // Função para obter a escala menor natural
    function getNaturalMinorScale(tonic) {
        // Encontrar a menor relativa (3 semitons abaixo)
        const notes = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];
        const tonicIndex = notes.indexOf(tonic);
        if (tonicIndex === -1) return "Não disponível";

        const minorTonicIndex = (tonicIndex + 9) % 12; // 3 semitons acima = 9 semitons abaixo
        const minorTonic = notes[minorTonicIndex];

        const scalePattern = [0, 2, 3, 5, 7, 8, 10]; // T-S-T-T-S-T-T
        const scale = scalePattern.map(interval =>
            notes[(minorTonicIndex + interval) % 12]
        );

        return scale.join(' - ');
    }

    // Função para obter os acordes da tonalidade
    function getChordsInKey(tonic) {
        const chordQualities = ['Maior', 'Menor', 'Menor', 'Maior', 'Maior', 'Menor', 'Diminuto'];
        const notes = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];

        const tonicIndex = notes.indexOf(tonic);
        if (tonicIndex === -1) return "Não disponível";

        // Padrão de intervalos para escala maior
        const intervals = [0, 2, 4, 5, 7, 9, 11];
        const chords = intervals.map((interval, i) => {
            const note = notes[(tonicIndex + interval) % 12];
            return `${note} ${chordQualities[i]}`;
        });

        return chords.join(', ');
    }

    // Adicionar estilos CSS para o modal
    const style = document.createElement('style');
    style.textContent = `
    .circle-note {
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .circle-note:hover {
        transform: scale(1.2);
        box-shadow: 0 0 15px rgba(255, 255, 255, 0.8);
    }
    
    #circle-of-fifths-modal h4 {
        color: var(--primary);
        margin-bottom: 15px;
    }
    
    #circle-of-fifths-modal h5 {
        color: var(--secondary);
        margin-top: 15px;
        margin-bottom: 5px;
    }
    
    #circle-of-fifths-modal p {
        margin-bottom: 10px;
        line-height: 1.5;
    }
`;
    document.head.appendChild(style);
}

// =============================================================================
// MÓDULO DE SEQUÊNCIA DE NOTAS
// =============================================================================

function setupNoteSequence() {
    const sequenceNotes = document.querySelectorAll('.sequence-note');
    const playSequenceBtn = document.getElementById('play-sequence');
    const repeatSequenceBtn = document.getElementById('repeat-sequence');
    
    if (!sequenceNotes.length || !playSequenceBtn || !repeatSequenceBtn) return;

    // Adicionar evento de clique a cada nota
    sequenceNotes.forEach(note => {
        note.addEventListener('click', handleSequenceNoteClick);
    });

    // Configurar botão de reproduzir sequência
    playSequenceBtn.addEventListener('click', generateNewSequence);

    // Configurar botão de repetir sequência
    repeatSequenceBtn.addEventListener('click', function () {
        if (AppState.games.noteSequence.currentSequence.length > 0) {
            playSequence();
        } else {
            alert("Gere uma sequência primeiro.");
        }
    });
}

function handleSequenceNoteClick() {
    if (AppState.games.noteSequence.isPlaying) return;

    const noteValue = this.dataset.note;
    AppState.games.noteSequence.userSequence.push(noteValue);
    this.classList.add('note-playing');

    // Tocar a nota
    const frequency = calculateFrequency(noteValue, 0);
    if (!isNaN(frequency)) {
        playTone(frequency, 0.3);
    }

    setTimeout(() => {
        this.classList.remove('note-playing');
    }, 500);

    // Verificar se o usuário completou a sequência
    if (AppState.games.noteSequence.userSequence.length === AppState.games.noteSequence.currentSequence.length) {
        checkSequence();
    }
}

function generateNewSequence() {
    AppState.games.noteSequence.currentSequence = [];
    AppState.games.noteSequence.userSequence = [];

    // Gerar 4-7 notas aleatórias
    const length = Math.floor(Math.random() * 4) + 4;
    for (let i = 0; i < length; i++) {
        const sequenceNotes = document.querySelectorAll('.sequence-note');
        if (sequenceNotes.length) {
            const randomNote = sequenceNotes[Math.floor(Math.random() * sequenceNotes.length)].dataset.note;
            AppState.games.noteSequence.currentSequence.push(randomNote);
        }
    }

    const currentSequenceElement = document.getElementById('current-sequence');
    if (currentSequenceElement) {
        currentSequenceElement.textContent = AppState.games.noteSequence.currentSequence.join(' - ');
    }
    playSequence();
}

function playSequence() {
    AppState.games.noteSequence.isPlaying = true;
    let i = 0;

    const playNextNote = () => {
        if (i < AppState.games.noteSequence.currentSequence.length) {
            const note = AppState.games.noteSequence.currentSequence[i];
            const noteElement = document.querySelector(`.sequence-note[data-note="${note}"]`);

            if (noteElement) {
                noteElement.classList.add('note-playing');

                // Tocar a nota
                const frequency = calculateFrequency(note, 0);
                if (!isNaN(frequency)) {
                    playTone(frequency, 0.3);
                }

                setTimeout(() => {
                    noteElement.classList.remove('note-playing');
                    i++;
                    setTimeout(playNextNote, 500);
                }, 500);
            } else {
                i++;
                setTimeout(playNextNote, 500);
            }
        } else {
            AppState.games.noteSequence.isPlaying = false;
            AppState.games.noteSequence.userSequence = [];
        }
    };

    playNextNote();
}

function checkSequence() {
    let correct = true;
    for (let i = 0; i < AppState.games.noteSequence.currentSequence.length; i++) {
        if (AppState.games.noteSequence.currentSequence[i] !== AppState.games.noteSequence.userSequence[i]) {
            correct = false;
            break;
        }
    }

    if (correct) {
        alert("Parabéns! Você reproduziu a sequência corretamente.");
    } else {
        alert("Sequência incorreta. Tente novamente.");
    }

    AppState.games.noteSequence.userSequence = [];
}

// =============================================================================
// MÓDULO DE TREINO DE INTERVALOS
// =============================================================================

function setupIntervalTraining() {
    const intervalOptions = document.querySelectorAll('.game-option');
    const playIntervalBtn = document.getElementById('play-interval');
    
    if (!intervalOptions.length || !playIntervalBtn) return;

    // Adicionar evento de clique ao botão de reproduzir intervalo
    playIntervalBtn.addEventListener('click', function () {
        // Selecionar um intervalo aleatório
        const intervals = Object.keys(CONFIG.INTERVALS);
        AppState.games.intervalTraining.currentInterval = intervals[Math.floor(Math.random() * intervals.length)];

        // Reproduzir o intervalo
        playInterval(AppState.games.intervalTraining.currentInterval);
    });

    // Adicionar evento de clique às opções de intervalo
    intervalOptions.forEach(option => {
        option.addEventListener('click', function () {
            if (AppState.games.intervalTraining.currentInterval === '') {
                alert("Por favor, reproduza um intervalo primeiro.");
                return;
            }

            const selectedInterval = this.dataset.interval;
            const scoreElement = document.getElementById('interval-game-score');

            if (selectedInterval === AppState.games.intervalTraining.currentInterval) {
                alert("Correto! Você identificou o intervalo corretamente.");
                AppState.games.intervalTraining.score += 10;
            } else {
                alert(`Incorreto. O intervalo era ${CONFIG.INTERVALS[AppState.games.intervalTraining.currentInterval].name}.`);
                AppState.games.intervalTraining.score = Math.max(0, AppState.games.intervalTraining.score - 5);
            }

            if (scoreElement) {
                scoreElement.textContent = AppState.games.intervalTraining.score;
            }
            AppState.games.intervalTraining.currentInterval = '';
        });
    });
}

function playInterval(interval) {
    const audioContext = getAudioContext();
    const frequencies = CONFIG.INTERVALS[interval].freqs;

    // Criar dois osciladores para as duas notas
    const oscillator1 = audioContext.createOscillator();
    const oscillator2 = audioContext.createOscillator();
    const gainNode = audioContext.createGain();

    oscillator1.type = 'sine';
    oscillator1.frequency.value = frequencies[0];
    oscillator2.type = 'sine';
    oscillator2.frequency.value = frequencies[1];
    gainNode.gain.value = 0.2;

    oscillator1.connect(gainNode);
    oscillator2.connect(gainNode);
    gainNode.connect(audioContext.destination);

    oscillator1.start();
    oscillator2.start();

    gainNode.gain.exponentialRampToValueAtTime(0.00001, audioContext.currentTime + 1.5);

    setTimeout(() => {
        oscillator1.stop();
        oscillator2.stop();
    }, 1500);
}

// =============================================================================
// MÓDULO DE DIAGRAMA DE ACORDES
// =============================================================================

function setupChordDiagram() {
    const chordSelect = document.getElementById('chord-select');
    const playChordBtn = document.getElementById('play-chord');
    
    if (!chordSelect || !playChordBtn) return;
    
    // Preencher o select com opções de acordes
    const chords = ['C', 'Cm', 'C7', 'Cmaj7', 'G', 'D', 'A', 'E'];
    chords.forEach(chord => {
        const option = document.createElement('option');
        option.value = chord;
        option.textContent = chord;
        chordSelect.appendChild(option);
    });

    // Atualizar diagrama de acorde quando a seleção mudar
    chordSelect.addEventListener('change', function() {
        updateChordDiagram(this.value);
    });

    // Atualização inicial
    updateChordDiagram(chordSelect.value);

    // Configurar botão de tocar acorde
    playChordBtn.addEventListener('click', function() {
        const selectedChord = chordSelect.value;
        playChord(selectedChord);
    });
}

function updateChordDiagram(chord) {
    const chordDiagram = document.getElementById('chord-diagram');
    if (!chordDiagram) return;

    chordDiagram.innerHTML = '';

    const chordPositions = {
        'C': { frets: [0, 3, 2, 0, 1, 0], fingers: ['x', '3', '2', 'x', '1', 'x'] },
        'Cm': { frets: [0, 3, 3, 0, 1, 0], fingers: ['x', '3', '4', 'x', '1', 'x'] },
        'C7': { frets: [0, 3, 2, 3, 1, 0], fingers: ['x', '3', '2', '4', '1', 'x'] },
        'Cmaj7': { frets: [0, 3, 2, 0, 0, 0], fingers: ['x', '2', '3', 'x', 'x', '1'] },
        'G': { frets: [3, 2, 0, 0, 0, 3], fingers: ['2', '1', 'x', 'x', 'x', '3'] },
        'D': { frets: [2, 3, 2, 0, 0, 0], fingers: ['2', '3', '1', 'x', 'x', 'x'] },
        'A': { frets: [0, 0, 2, 2, 2, 0], fingers: ['x', 'x', '1', '2', '3', 'x'] },
        'E': { frets: [0, 2, 2, 1, 0, 0], fingers: ['x', '3', '4', '2', 'x', '1'] }
    };

    const chordConfig = chordPositions[chord] || chordPositions['C'];

    const container = document.createElement('div');
    container.className = 'chord-container';

    const neck = document.createElement('div');
    neck.className = 'neck';
    container.appendChild(neck);

    const neckWidth = 180;
    const neckHeight = 200;
    const stringSpacing = neckWidth / (6 - 1); // 6 cordas → 5 espaços
    const fretSpacing = neckHeight / 4;        // 4 trastes → 4 espaços
    const fingerSize = 26;

    // Cordas
    for (let i = 0; i < 6; i++) {
        const string = document.createElement('div');
        string.className = 'string';
        string.style.left = `${i * stringSpacing}px`;
        neck.appendChild(string);
    }

    // Trastes
    for (let i = 0; i <= 4; i++) {
        const fret = document.createElement('div');
        fret.className = 'fret';
        fret.style.top = `${i * fretSpacing}px`;
        neck.appendChild(fret);
    }

    // Dedos
    chordConfig.frets.forEach((fret, i) => {
        if (fret > 0) {
            const finger = document.createElement('div');
            finger.className = 'finger';
            finger.style.left = `${(i * stringSpacing) - (fingerSize / 2)}px`;
            finger.style.top = `${((fret - 1) * fretSpacing) + (fretSpacing / 2) - (fingerSize / 2)}px`;
            finger.textContent = chordConfig.fingers[i];
            neck.appendChild(finger);
        }
    });

    // Marcadores O e X
    chordConfig.frets.forEach((fret, i) => {
        if (fret === 0 || chordConfig.fingers[i] === 'x') {
            const marker = document.createElement('div');
            marker.className = 'marker';
            marker.style.left = `${(i * stringSpacing) - 8}px`;
            marker.style.top = `-24px`;
            marker.textContent = fret === 0 ? 'O' : 'X';
            marker.style.background = fret === 0 ? '#27ae60' : '#e74c3c';
            container.appendChild(marker);
        }
    });

    // Nome do acorde
    const chordName = document.createElement('div');
    chordName.className = 'chord-name';
    chordName.textContent = chord;
    container.appendChild(chordName);

    chordDiagram.appendChild(container);
}

// Interação com select
document.getElementById('chord-select').addEventListener('change', function () {
    updateChordDiagram(this.value);
});

// Acorde inicial
updateChordDiagram('C');




function playChord(chord) {
    const audioContext = getAudioContext();

    // Frequências dos acordes (em Hz)
    const chordFrequencies = {
        'C': [261.63, 329.63, 392.00],        // C, E, G
        'Cm': [261.63, 311.13, 392.00],       // C, D#, G
        'C7': [261.63, 329.63, 392.00, 466.16], // C, E, G, A#
        'Cmaj7': [261.63, 329.63, 392.00, 523.25], // C, E, G, B
        'G': [392.00, 493.88, 587.33],        // G, B, D
        'D': [293.66, 369.99, 440.00],        // D, F#, A
        'A': [440.00, 554.37, 659.25],        // A, C#, E
        'E': [329.63, 415.30, 493.88]         // E, G#, B
    };

    const frequencies = chordFrequencies[chord] || chordFrequencies['C'];

    // Criar ganho principal
    const gainNode = audioContext.createGain();
    gainNode.gain.value = 0.2;
    gainNode.connect(audioContext.destination);

    // Criar osciladores para cada frequência do acorde
    frequencies.forEach((freq, index) => {
        const oscillator = audioContext.createOscillator();
        oscillator.type = 'sine';
        oscillator.frequency.value = freq;
        
        // Adicionar pequeno atraso para criar efeito de arpejo
        const delay = audioContext.createDelay();
        delay.delayTime.value = index * 0.05;
        
        oscillator.connect(delay);
        delay.connect(gainNode);
        
        oscillator.start();
        
        // Parar o oscilador após 1.5 segundos
        setTimeout(() => {
            oscillator.stop();
        }, 1500);
    });

    // Fade out suave
    gainNode.gain.exponentialRampToValueAtTime(0.00001, audioContext.currentTime + 1.5);
}

// =============================================================================
// MÓDULO GERADOR DE PROGRESSÕES
// =============================================================================

function setupProgressionGenerator() {
    const generateButton = document.getElementById('generate-progression');
    const styleSelect = document.getElementById('progression-style');
    const lengthSelect = document.getElementById('progression-length');
    
    if (!generateButton || !styleSelect || !lengthSelect) return;

    // Preencher selects com opções
    const styles = ['pop', 'rock', 'jazz', 'blues', 'classical'];
    const lengths = [4, 8, 12, 16];
    
    styles.forEach(style => {
        const option = document.createElement('option');
        option.value = style;
        option.textContent = style.charAt(0).toUpperCase() + style.slice(1);
        styleSelect.appendChild(option);
    });
    
    lengths.forEach(length => {
        const option = document.createElement('option');
        option.value = length;
        option.textContent = length + ' acordes';
        lengthSelect.appendChild(option);
    });

    generateButton.addEventListener('click', function() {
        const style = styleSelect.value;
        const length = parseInt(lengthSelect.value);
        
        // Gerar progressão com base no estilo e comprimento
        const progression = generateChordProgression(style, length);
        
        // Exibir progressão
        const progressionDisplay = document.querySelector('.chord-progression');
        if (progressionDisplay) {
            progressionDisplay.textContent = progression.join(' - ');
        }
        
        // Adicionar botão para tocar progressão
        addPlayProgressionButton(progression);
    });
}

function generateChordProgression(style, length) {
    // Progressões básicas para diferentes estilos
    const progressions = {
        pop: [
            ['C', 'G', 'Am', 'F'],
            ['C', 'Em', 'F', 'G'],
            ['Am', 'F', 'C', 'G'],
            ['C', 'F', 'Am', 'G']
        ],
        rock: [
            ['E', 'A', 'D', 'E'],
            ['A', 'D', 'E', 'A'],
            ['G', 'C', 'D', 'G'],
            ['E', 'D', 'A', 'E']
        ],
        jazz: [
            ['Dm7', 'G7', 'Cmaj7', 'Am7'],
            ['Em7', 'A7', 'Dmaj7', 'Bm7'],
            ['Cmaj7', 'Am7', 'Dm7', 'G7'],
            ['Fmaj7', 'Dm7', 'G7', 'C7']
        ],
        blues: [
            ['C7', 'C7', 'C7', 'C7', 'F7', 'F7', 'C7', 'C7', 'G7', 'F7', 'C7', 'G7'],
            ['A7', 'D7', 'A7', 'A7', 'D7', 'D7', 'A7', 'A7', 'E7', 'D7', 'A7', 'E7']
        ],
        classical: [
            ['I', 'IV', 'V', 'I'],
            ['I', 'vi', 'IV', 'V'],
            ['ii', 'V', 'I', 'vi'],
            ['I', 'V', 'vi', 'iii', 'IV', 'I', 'IV', 'V']
        ]
    };

    // Selecionar uma progressão aleatória do estilo escolhido
    const styleProgressions = progressions[style];
    const randomProgression = styleProgressions[Math.floor(Math.random() * styleProgressions.length)];

    // Se a progressão selecionada for mais curta que a solicitada, repeti-la
    if (randomProgression.length < length) {
        const repeatedProgression = [];
        for (let i = 0; i < length; i++) {
            repeatedProgression.push(randomProgression[i % randomProgression.length]);
        }
        return repeatedProgression;
    }

    // Se a progressão selecionada for mais longa que a solicitada, truncá-la
    if (randomProgression.length > length) {
        return randomProgression.slice(0, length);
    }

    return randomProgression;
}

function addPlayProgressionButton(progression) {
    // Remover botão anterior se existir
    const oldButton = document.getElementById('play-progression');
    if (oldButton) {
        oldButton.remove();
    }

    const progressionDisplay = document.querySelector('.progression-display');
    if (!progressionDisplay) return;
    
    const playButton = document.createElement('button');
    playButton.id = 'play-progression';
    playButton.className = 'btn btn-success mt-3';
    playButton.innerHTML = '<i class="fas fa-play me-2"></i>Tocar Progressão';
    
    playButton.addEventListener('click', function() {
        playChordProgression(progression);
    });

    progressionDisplay.appendChild(playButton);
}

function playChordProgression(progression) {
    const audioContext = getAudioContext();
    const bpm = 120; // Batidas por minuto
    const chordDuration = 60 / bpm * 2; // 2 batidas por acorde

    progression.forEach((chord, index) => {
        setTimeout(() => {
            playChord(chord);
            
            // Destacar o acorde atual na exibição
            const progressionText = document.querySelector('.chord-progression');
            if (progressionText) {
                const chords = progressionText.textContent.split(' - ');
                chords[index] = `<strong>${chords[index]}</strong>`;
                progressionText.innerHTML = chords.join(' - ');
                
                // Remover destaque após um tempo
                setTimeout(() => {
                    progressionText.textContent = progression.join(' - ');
                }, chordDuration * 1000 / 2);
            }
            
        }, index * chordDuration * 1000);
    });
}

// =============================================================================
// MÓDULO DE IDENTIFICAÇÃO DE NOTAS
// =============================================================================

function setupNoteIdentificationGame() {
    const newNoteButton = document.getElementById('new-note');
    const scoreElement = document.getElementById('note-game-score');
    
    if (!newNoteButton || !scoreElement) return;

    // Inicializar pontuação
    AppState.games.noteIdentification.score = 0;
    scoreElement.textContent = '0';

    newNoteButton.addEventListener('click', generateNewNote);

    // Adicionar event listener a todas as notas no braço
    document.addEventListener('click', function(e) {
        if (e.target.classList.contains('note') && AppState.games.noteIdentification.currentNote !== '') {
            const selectedNote = e.target.dataset.note;
            
            if (selectedNote === AppState.games.noteIdentification.currentNote) {
                // Resposta correta
                AppState.games.noteIdentification.score += 5;
                scoreElement.textContent = AppState.games.noteIdentification.score;
                
                // Feedback visual
                showGameFeedback('Correto! +5 pontos', 'success');
                generateNewNote();
            } else {
                // Resposta errada
                AppState.games.noteIdentification.score = Math.max(0, AppState.games.noteIdentification.score - 2);
                scoreElement.textContent = AppState.games.noteIdentification.score;
                
                // Feedback visual
                showGameFeedback(`Incorreto. A nota era ${AppState.games.noteIdentification.currentNote}. -2 pontos`, 'error');
            }
        }
    });

    // Iniciar com uma nota
    generateNewNote();
}

function generateNewNote() {
    const notes = Object.keys(CONFIG.NOTE_FREQUENCIES);
    AppState.games.noteIdentification.currentNote = notes[Math.floor(Math.random() * notes.length)];
    
    const noteToFindElement = document.getElementById('note-to-find');
    if (noteToFindElement) {
        noteToFindElement.textContent = AppState.games.noteIdentification.currentNote;
    }
}

function showGameFeedback(message, type) {
    // Remover feedback anterior
    const oldFeedback = document.getElementById('game-feedback');
    if (oldFeedback) {
        oldFeedback.remove();
    }

    const feedback = document.createElement('div');
    feedback.id = 'game-feedback';
    feedback.style.cssText = `
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        padding: 20px;
        background: ${type === 'success' ? '#27ae60' : '#e74c3c'};
        color: white;
        border-radius: 10px;
        z-index: 1000;
        font-weight: bold;
    `;
    feedback.textContent = message;
    
    document.body.appendChild(feedback);
    
    // Remover após 2 segundos
    setTimeout(() => {
        if (document.body.contains(feedback)) {
            document.body.removeChild(feedback);
        }
    }, 2000);
}

// =============================================================================
// MÓDULO DE REFERÊNCIAS DE AFINAÇÃO
// =============================================================================

function setupTuningReferences() {
    const tuningContainer = document.querySelector('.tuning-container');
    
    // Verificar se o container existe antes de manipular
    if (!tuningContainer) {
        console.warn('Elemento .tuning-container não encontrado no DOM');
        return;
    }
    
    // Limpar container existente
    tuningContainer.innerHTML = '';
    
    // Afinações padrão para diferentes instrumentos
    const tunings = {
        'Violão': ['E2', 'A2', 'D3', 'G3', 'B3', 'E4'],
        'Baixo': ['E1', 'A1', 'D2', 'G2'],
        'Violino': ['G3', 'D4', 'A4', 'E5'],
        'Violoncelo': ['C2', 'G2', 'D3', 'A3'],
        'Ukulele': ['G4', 'C4', 'E4', 'A4']
    };

    // Criar botões para cada nota de afinação
    Object.entries(tunings).forEach(([instrument, notes]) => {
        const instrumentSection = document.createElement('div');
        instrumentSection.className = 'tuning-section mb-4';
        instrumentSection.innerHTML = `<h5 class="mb-2">${instrument}</h5>`;
        
        const buttonContainer = document.createElement('div');
        buttonContainer.className = 'd-flex flex-wrap gap-2';
        
        notes.forEach(note => {
            const button = document.createElement('button');
            button.className = 'btn btn-outline-primary btn-sm tuning-btn';
            button.textContent = note;
            button.dataset.note = note;
            
            button.addEventListener('click', function() {
                playTuningNote(note);
                
                // Feedback visual
                this.classList.add('btn-primary');
                this.classList.remove('btn-outline-primary');
                
                setTimeout(() => {
                    this.classList.remove('btn-primary');
                    this.classList.add('btn-outline-primary');
                }, 1000);
            });
            
            buttonContainer.appendChild(button);
        });
        
        instrumentSection.appendChild(buttonContainer);
        tuningContainer.appendChild(instrumentSection);
    });
}

function playTuningNote(note) {
    // Mapeamento de notas para frequências (em Hz)
    const noteFrequencies = {
        'E1': 41.20, 'A1': 55.00, 'D2': 73.42, 'G2': 98.00,
        'E2': 82.41, 'A2': 110.00, 'D3': 146.83, 'G3': 196.00,
        'B3': 246.94, 'E4': 329.63, 'G4': 392.00, 'C4': 261.63,
        'E5': 659.25, 'A4': 440.00, 'D4': 293.66, 'C2': 65.41,
        'G5': 783.99, 'A3': 220.00
    };

     const frequency = noteFrequencies[note] || 440.00;
    playTone(frequency, 2, 'sine', 0.3);
}

// =============================================================================
// FUNÇÕES AUXILIARES E DE UTILIDADE
// =============================================================================

// Função para verificar se um elemento existe antes de manipulá-lo
function safeQuerySelector(selector) {
    const element = document.querySelector(selector);
    if (!element) {
        console.warn(`Elemento não encontrado: ${selector}`);
    }
    return element;
}

// Função para adicionar evento seguro (verifica se o elemento existe)
function addSafeEventListener(selector, event, handler) {
    const element = document.querySelector(selector);
    if (element) {
        element.addEventListener(event, handler);
    } else {
        console.warn(`Não foi possível adicionar evento: ${selector} não encontrado`);
    }
}

// Função para carregar componentes dinamicamente
function loadComponent(componentId, url) {
    fetch(url)
        .then(response => response.text())
        .then(html => {
            const element = document.getElementById(componentId);
            if (element) {
                element.innerHTML = html;
                // Re-inicializar componentes após carregamento
                initApp();
            }
        })
        .catch(error => {
            console.error(`Erro ao carregar componente ${componentId}:`, error);
        });
}

// Função para debounce (evitar múltiplas execuções)
function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
        const later = () => {
            clearTimeout(timeout);
            func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
    };
}

// Função para throttle (limitar execuções por tempo)
function throttle(func, limit) {
    let inThrottle;
    return function() {
        const args = arguments;
        const context = this;
        if (!inThrottle) {
            func.apply(context, args);
            inThrottle = true;
            setTimeout(() => inThrottle = false, limit);
        }
    }
}

// =============================================================================
// MANIPULAÇÃO DE ERROS GLOBAIS
// =============================================================================

// Capturar erros não tratados
window.addEventListener('error', function(e) {
    console.error('Erro não tratado:', e.error);
    
    // Exibir mensagem amigável para o usuário
    const errorDisplay = document.getElementById('error-display');
    if (!errorDisplay) {
        const errorDiv = document.createElement('div');
        errorDiv.id = 'error-display';
        errorDiv.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: #e74c3c;
            color: white;
            padding: 15px;
            border-radius: 5px;
            z-index: 9999;
            max-width: 300px;
        `;
        errorDiv.innerHTML = `
            <strong>Ocorreu um erro</strong>
            <p>Recarregue a página ou tente novamente mais tarde.</p>
            <button onclick="this.parentElement.style.display='none'" 
                    style="background: white; color: #e74c3c; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer;">
                Fechar
            </button>
        `;
        document.body.appendChild(errorDiv);
    }
});

// =============================================================================
// OTIMIZAÇÕES DE PERFORMANCE
// =============================================================================

// Observer para elementos que entram/saem da viewport
function setupIntersectionObserver() {
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('in-viewport');
                // Carregar recursos sob demanda
                if (entry.target.dataset.lazyLoad) {
                    loadLazyContent(entry.target);
                }
            }
        });
    }, { threshold: 0.1 });

    // Observar elementos com atributo data-lazy
    document.querySelectorAll('[data-lazy]').forEach(el => {
        observer.observe(el);
    });
}

function loadLazyContent(element) {
    const src = element.dataset.lazyLoad;
    if (src && !element.dataset.loaded) {
        element.dataset.loaded = true;
        // Carregar conteúdo lazy
        if (element.tagName === 'IMG') {
            element.src = src;
        }
    }
}

// =============================================================================
// RESPONSIVIDADE E AJUSTES DE LAYOUT
// =============================================================================

function setupResponsiveLayout() {
    // Ajustar layout baseado no tamanho da tela
    function handleResize() {
        const isMobile = window.innerWidth < 768;
        document.body.classList.toggle('mobile-view', isMobile);
        
        // Ajustes específicos para mobile
        if (isMobile) {
            adjustForMobile();
        } else {
            adjustForDesktop();
        }
    }

    // Debounce para redimensionamento
    window.addEventListener('resize', debounce(handleResize, 250));
    handleResize(); // Executar inicialmente
}

function adjustForMobile() {
    // Simplificar interface para mobile
    const complexElements = document.querySelectorAll('.desktop-only');
    complexElements.forEach(el => {
        el.style.display = 'none';
    });
    
    // Ajustar tamanho de botões para toque
    const touchElements = document.querySelectorAll('button, .btn, .note');
    touchElements.forEach(el => {
        el.style.minHeight = '44px';
        el.style.minWidth = '44px';
    });
}

function adjustForDesktop() {
    // Restaurar elementos ocultos no mobile
    const complexElements = document.querySelectorAll('.desktop-only');
    complexElements.forEach(el => {
        el.style.display = '';
    });
}

// =============================================================================
// ANIMAÇÕES E FEEDBACK VISUAL
// =============================================================================

function setupAnimations() {
    // Animações de entrada suave
    const animatedElements = document.querySelectorAll('.fade-in, .slide-in');
    
    animatedElements.forEach((el, index) => {
        el.style.opacity = '0';
        el.style.transform = 'translateY(20px)';
        
        setTimeout(() => {
            el.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
            el.style.opacity = '1';
            el.style.transform = 'translateY(0)';
        }, index * 100);
    });
}

// Feedback visual para interações
function addVisualFeedback() {
    // Feedback para cliques
    document.addEventListener('click', function(e) {
        if (e.target.matches('button, .btn, .note, .card')) {
            const element = e.target;
            element.classList.add('active-feedback');
            setTimeout(() => {
                element.classList.remove('active-feedback');
            }, 300);
        }
    });
}

// =============================================================================
// PERSISTÊNCIA DE DADOS (LOCALSTORAGE)
// =============================================================================

function setupDataPersistence() {
    // Salvar estado ao fechar/recarregar
    window.addEventListener('beforeunload', saveAppState);
    
    // Carregar estado salvo
    loadAppState();
}

function saveAppState() {
    try {
        const stateToSave = {
            currentInstrument: AppState.currentInstrument,
            games: AppState.games,
            metronome: {
                bpm: document.getElementById('bpm-slider')?.value || CONFIG.DEFAULT_BPM
            }
        };
        localStorage.setItem('musicTrainerState', JSON.stringify(stateToSave));
    } catch (error) {
        console.error('Erro ao salvar estado:', error);
    }
}

function loadAppState() {
    try {
        const savedState = localStorage.getItem('musicTrainerState');
        if (savedState) {
            const state = JSON.parse(savedState);
            
            // Restaurar instrumento
            if (state.currentInstrument) {
                AppState.currentInstrument = state.currentInstrument;
                const instrumentSelect = document.getElementById('instrument-select');
                if (instrumentSelect) instrumentSelect.value = state.currentInstrument;
                
                const instrumentBtn = document.querySelector(`.instrument-btn[data-instrument="${state.currentInstrument}"]`);
                if (instrumentBtn) {
                    document.querySelectorAll('.instrument-btn').forEach(btn => btn.classList.remove('active'));
                    instrumentBtn.classList.add('active');
                }
            }
            
            // Restaurar pontuações dos jogos
            if (state.games) {
                Object.assign(AppState.games, state.games);
                
                // Atualizar displays de pontuação
                const noteScore = document.getElementById('note-game-score');
                if (noteScore) noteScore.textContent = state.games.noteIdentification?.score || '0';
                
                const intervalScore = document.getElementById('interval-game-score');
                if (intervalScore) intervalScore.textContent = state.games.intervalTraining?.score || '0';
            }
            
            // Restaurar BPM do metrônomo
            if (state.metronome?.bpm) {
                const bpmSlider = document.getElementById('bpm-slider');
                const bpmDisplay = document.getElementById('bpm-display');
                if (bpmSlider && bpmDisplay) {
                    bpmSlider.value = state.metronome.bpm;
                    bpmDisplay.textContent = `${state.metronome.bpm} BPM`;
                }
            }
        }
    } catch (error) {
        console.error('Erro ao carregar estado:', error);
    }
}

// =============================================================================
// ACESSIBILIDADE
// =============================================================================

function setupAccessibility() {
    // Suporte a navegação por teclado
    document.addEventListener('keydown', function(e) {
        // Atalhos de teclado
        switch(e.key) {
            case ' ': // Espaço - tocar/parar metrônomo
                const metronomeBtn = document.getElementById('metronome-toggle');
                if (metronomeBtn && document.activeElement !== metronomeBtn) {
                    e.preventDefault();
                    metronomeBtn.click();
                }
                break;
            case 'Escape': // ESC - fechar modais
                const modals = document.querySelectorAll('.modal, [role="dialog"]');
                modals.forEach(modal => {
                    if (modal.style.display !== 'none') {
                        modal.style.display = 'none';
                    }
                });
                break;
        }
    });
    
    // Melhorar foco visual
    const focusableElements = document.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
    focusableElements.forEach(el => {
        el.addEventListener('focus', () => {
            el.classList.add('keyboard-focus');
        });
        el.addEventListener('blur', () => {
            el.classList.remove('keyboard-focus');
        });
    });
}

// =============================================================================
// INICIALIZAÇÃO COMPLETA
// =============================================================================

// Função de inicialização estendida
function extendedInit() {
    // Configurações adicionais
    setupResponsiveLayout();
    setupIntersectionObserver();
    setupAnimations();
    addVisualFeedback();
    setupDataPersistence();
    setupAccessibility();
    
    // Verificar suporte a Web Audio API
    if (!window.AudioContext && !window.webkitAudioContext) {
        showBrowserWarning();
    }
}

function showBrowserWarning() {
    const warning = document.createElement('div');
    warning.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        background: #ff9800;
        color: white;
        padding: 10px;
        text-align: center;
        z-index: 9999;
    `;
    warning.innerHTML = `
        ⚠️ Seu navegador pode não suportar todas as funcionalidades de áudio. 
        Recomendamos usar Chrome, Firefox ou Edge para melhor experiência.
    `;
    document.body.appendChild(warning);
}

// Adicionar inicialização estendida ao carregamento principal
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', extendedInit);
} else {
    extendedInit();
}

// =============================================================================
// EXPORTAÇÃO PARA USO EXTERNO (se necessário)
// =============================================================================

// Tornar funções principais disponíveis globalmente
window.MusicTrainer = {
    playTone,
    playChord,
    generateFretboard,
    changeInstrument,
    startMetronome: function(bpm) {
        const bpmSlider = document.getElementById('bpm-slider');
        if (bpmSlider) {
            bpmSlider.value = bpm;
            document.getElementById('bpm-display').textContent = `${bpm} BPM`;
            if (AppState.metronome.isPlaying) {
                clearInterval(AppState.metronome.intervalId);
                startMetronome(bpm);
            }
        }
    }
};

// =============================================================================
// POLYFILLS PARA COMPATIBILIDADE
// =============================================================================

// Polyfill para Element.closest()
if (!Element.prototype.closest) {
    Element.prototype.closest = function(s) {
        var el = this;
        do {
            if (el.matches(s)) return el;
            el = el.parentElement || el.parentNode;
        } while (el !== null && el.nodeType === 1);
        return null;
    };
}

// Polyfill para NodeList.forEach()
if (window.NodeList && !NodeList.prototype.forEach) {
    NodeList.prototype.forEach = Array.prototype.forEach;
}

// Polyfill para Element.matches()
if (!Element.prototype.matches) {
    Element.prototype.matches = 
        Element.prototype.matchesSelector || 
        Element.prototype.mozMatchesSelector ||
        Element.prototype.msMatchesSelector || 
        Element.prototype.oMatchesSelector || 
        Element.prototype.webkitMatchesSelector ||
        function(s) {
            var matches = (this.document || this.ownerDocument).querySelectorAll(s),
                i = matches.length;
            while (--i >= 0 && matches.item(i) !== this) {}
            return i > -1;            
        };
}

// Polyfill para Object.assign (para navegadores mais antigos)
if (typeof Object.assign !== 'function') {
    Object.assign = function(target) {
        'use strict';
        if (target == null) {
            throw new TypeError('Cannot convert undefined or null to object');
        }

        var to = Object(target);
        
        for (var index = 1; index < arguments.length; index++) {
            var nextSource = arguments[index];
            
            if (nextSource != null) {
                for (var nextKey in nextSource) {
                    if (Object.prototype.hasOwnProperty.call(nextSource, nextKey)) {
                        to[nextKey] = nextSource[nextKey];
                    }
                }
            }
        }
        return to;
    };
}

// =============================================================================
// MANIPULAÇÃO DO SERVICE WORKER (PWA) - CÓDIGO CORRIGIDO
// =============================================================================

// Registrar Service Worker para funcionalidade offline
if ('serviceWorker' in navigator) {
    window.addEventListener('load', function() {
        // Usar caminho relativo para evitar problemas
        navigator.serviceWorker.register('./sw.js')
            .then(function(registration) {
                console.log('ServiceWorker registrado com sucesso: ', registration.scope);
                
                // Verificar se há uma nova versão disponível
                registration.addEventListener('updatefound', function() {
                    const newWorker = registration.installing;
                    console.log('Nova versão do Service Worker encontrada');
                    
                    newWorker.addEventListener('statechange', function() {
                        if (newWorker.state === 'installed') {
                            console.log('Nova versão instalada. Recarregue para atualizar.');
                        }
                    });
                });
            })
            .catch(function(error) {
                console.log('Falha no registro do ServiceWorker: ', error);
                // Não mostrar erro para o usuário, a aplicação funciona sem SW
            });
    });
    
    // Verificar atualizações periodicamente
    setInterval(function() {
        if (navigator.serviceWorker.controller) {
            navigator.serviceWorker.controller.postMessage({type: 'CHECK_UPDATE'});
        }
    }, 60 * 60 * 1000); // Verificar a cada hora
}

// =============================================================================
// GERENCIAMENTO DE CONEXÃO
// =============================================================================

// Detectar mudanças no status da conexão
function setupConnectionMonitoring() {
    function updateConnectionStatus() {
        const isOnline = navigator.onLine;
        const statusElement = document.getElementById('connection-status');
        
        if (statusElement) {
            if (isOnline) {
                statusElement.style.display = 'none';
            } else {
                statusElement.style.display = 'block';
                statusElement.textContent = '⚠️ Você está offline. Algumas funcionalidades podem não estar disponíveis.';
            }
        }
        
        // Atualizar estado da aplicação baseado na conectividade
        document.body.classList.toggle('offline', !isOnline);
    }

    window.addEventListener('online', updateConnectionStatus);
    window.addEventListener('offline', updateConnectionStatus);
    updateConnectionStatus(); // Status inicial
}

// =============================================================================
// OTIMIZAÇÕES DE PERFORMANCE AVANÇADAS
// =============================================================================

// Pré-carregar recursos críticos
function preloadCriticalResources() {
    const resources = [
        // Adicione URLs de recursos críticos aqui
    ];
    
    resources.forEach(resource => {
        const link = document.createElement('link');
        link.rel = 'preload';
        link.href = resource;
        link.as = 'script'; // ou 'style', 'font', etc.
        document.head.appendChild(link);
    });
}

// Lazy loading para imagens não críticas
function setupLazyLoading() {
    const lazyImages = [].slice.call(document.querySelectorAll('img.lazy'));
    
    if ('IntersectionObserver' in window) {
        const lazyImageObserver = new IntersectionObserver(function(entries, observer) {
            entries.forEach(function(entry) {
                if (entry.isIntersecting) {
                    const lazyImage = entry.target;
                    lazyImage.src = lazyImage.dataset.src;
                    lazyImage.classList.remove('lazy');
                    lazyImageObserver.unobserve(lazyImage);
                }
            });
        });

        lazyImages.forEach(function(lazyImage) {
            lazyImageObserver.observe(lazyImage);
        });
    } else {
        // Fallback para navegadores sem Intersection Observer
        lazyImages.forEach(function(lazyImage) {
            lazyImage.src = lazyImage.dataset.src;
        });
    }
}

// =============================================================================
// ANÁLISE E MONITORAMENTO
// =============================================================================

// Funções simples de analytics
const Analytics = {
    trackEvent: function(category, action, label) {
        if (typeof gtag !== 'undefined') {
            gtag('event', action, {
                'event_category': category,
                'event_label': label
            });
        }
        console.log(`Event tracked: ${category} - ${action} - ${label}`);
    },
    
    trackPageView: function(pageName) {
        if (typeof gtag !== 'undefined') {
            gtag('config', 'GA_MEASUREMENT_ID', {
                'page_title': pageName,
                'page_location': window.location.href
            });
        }
        console.log(`Page view: ${pageName}`);
    }
};

// =============================================================================
// INTERNACIONALIZAÇÃO (i18n)
// =============================================================================

// Sistema simples de internacionalização
const I18n = {
    currentLanguage: 'pt-BR',
    translations: {
        'pt-BR': {
            'play': 'Tocar',
            'stop': 'Parar',
            'note': 'Nota',
            'scale': 'Escala',
            'chord': 'Acorde'
            // Adicione mais traduções aqui
        },
        'en-US': {
            'play': 'Play',
            'stop': 'Stop',
            'note': 'Note',
            'scale': 'Scale',
            'chord': 'Chord'
        }
    },
    
    t: function(key) {
        return this.translations[this.currentLanguage][key] || key;
    },
    
    setLanguage: function(language) {
        if (this.translations[language]) {
            this.currentLanguage = language;
            this.updateUI();
        }
    },
    
    updateUI: function() {
        // Atualizar todos os elementos com data-i18n
        document.querySelectorAll('[data-i18n]').forEach(element => {
            const key = element.getAttribute('data-i18n');
            element.textContent = this.t(key);
        });
        
        // Atualizar placeholders
        document.querySelectorAll('[data-i18n-placeholder]').forEach(element => {
            const key = element.getAttribute('data-i18n-placeholder');
            element.placeholder = this.t(key);
        });
    }
};

// =============================================================================
// GERENCIAMENTO DE TEMA
// =============================================================================

function setupThemeManager() {
    const themeToggle = document.getElementById('theme-toggle');
    const prefersDarkScheme = window.matchMedia('(prefers-color-scheme: dark)');
    
    // Carregar tema salvo ou usar preferência do sistema
    const savedTheme = localStorage.getItem('theme');
    const systemTheme = prefersDarkScheme.matches ? 'dark' : 'light';
    const currentTheme = savedTheme || systemTheme;
    
    document.documentElement.setAttribute('data-theme', currentTheme);
    
    if (themeToggle) {
        themeToggle.checked = currentTheme === 'dark';
        
        themeToggle.addEventListener('change', function() {
            const newTheme = this.checked ? 'dark' : 'light';
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
        });
    }
    
    // Observar mudanças na preferência do sistema
    prefersDarkScheme.addEventListener('change', e => {
        if (!localStorage.getItem('theme')) {
            document.documentElement.setAttribute('data-theme', e.matches ? 'dark' : 'light');
        }
    });
}

// =============================================================================
// VALIDAÇÃO DE FORMULÁRIOS
// =============================================================================

function setupFormValidation() {
    const forms = document.querySelectorAll('form[data-validate]');
    
    forms.forEach(form => {
        form.addEventListener('submit', function(e) {
            if (!validateForm(this)) {
                e.preventDefault();
            }
        });
    });
}

function validateForm(form) {
    let isValid = true;
    const inputs = form.querySelectorAll('input[required], select[required], textarea[required]');
    
    inputs.forEach(input => {
        if (!input.value.trim()) {
            showValidationError(input, 'Este campo é obrigatório');
            isValid = false;
        } else {
            clearValidationError(input);
        }
        
        // Validações específicas por tipo
        if (input.type === 'email' && input.value) {
            if (!isValidEmail(input.value)) {
                showValidationError(input, 'Por favor, insira um email válido');
                isValid = false;
            }
        }
    });
    
    return isValid;
}

function isValidEmail(email) {
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return emailRegex.test(email);
}

function showValidationError(input, message) {
    clearValidationError(input);
    
    const errorDiv = document.createElement('div');
    errorDiv.className = 'validation-error';
    errorDiv.textContent = message;
    errorDiv.style.cssText = 'color: #e74c3c; font-size: 0.875rem; margin-top: 0.25rem;';
    
    input.parentNode.appendChild(errorDiv);
    input.classList.add('invalid');
}

function clearValidationError(input) {
    const errorDiv = input.parentNode.querySelector('.validation-error');
    if (errorDiv) {
        errorDiv.remove();
    }
    input.classList.remove('invalid');
}

// =============================================================================
// UTILITÁRIOS DE ÁUDIO AVANÇADOS
// =============================================================================

// Analisador de espectro para visualização de áudio
function setupAudioAnalyzer() {
    const audioContext = getAudioContext();
    const analyser = audioContext.createAnalyser();
    analyser.fftSize = 256;
    
    return {
        analyser,
        connectToSource: function(source) {
            source.connect(analyser);
            return analyser;
        },
        getFrequencyData: function() {
            const dataArray = new Uint8Array(analyser.frequencyBinCount);
            analyser.getByteFrequencyData(dataArray);
            return dataArray;
        },
        getWaveformData: function() {
            const dataArray = new Uint8Array(analyser.frequencyBinCount);
            analyser.getByteTimeDomainData(dataArray);
            return dataArray;
        }
    };
}

// Gerador de ruído para testes de áudio
function generateNoise(type = 'white', duration = 1.0) {
    const audioContext = getAudioContext();
    const bufferSize = 2 * audioContext.sampleRate;
    const noiseBuffer = audioContext.createBuffer(1, bufferSize, audioContext.sampleRate);
    const output = noiseBuffer.getChannelData(0);
    
    let lastOut = 0.0;
    
    for (let i = 0; i < bufferSize; i++) {
        if (type === 'white') {
            output[i] = Math.random() * 2 - 1;
        } else if (type === 'pink') {
            // Algoritmo de ruído rosa
            const white = Math.random() * 2 - 1;
            output[i] = (lastOut + (0.02 * white)) / 1.02;
            lastOut = output[i];
            output[i] *= 3.5; // Ajuste de ganho
        } else if (type === 'brown') {
            // Algoritmo de ruído marrom
            const white = Math.random() * 2 - 1;
            output[i] = (lastOut + (0.02 * white)) / 1.02;
            lastOut = output[i];
            output[i] *= 6.0; // Ajuste de ganho
        }
    }
    
    const source = audioContext.createBufferSource();
    source.buffer = noiseBuffer;
    source.loop = true;
    
    const gainNode = audioContext.createGain();
    source.connect(gainNode);
    gainNode.connect(audioContext.destination);
    
    source.start();
    
    // Parar após a duração especificada
    setTimeout(() => {
        source.stop();
    }, duration * 1000);
    
    return {
        source,
        gainNode,
        stop: function() {
            source.stop();
        }
    };
}

// =============================================================================
// EXPORTAÇÕES FINAIS E INICIALIZAÇÃO
// =============================================================================

// Exportar utilitários globais
window.AppUtils = {
    debounce,
    throttle,
    Analytics,
    I18n,
    generateNoise,
    setupAudioAnalyzer
};

// Inicialização final quando tudo estiver carregado
window.addEventListener('load', function() {
    console.log('Music Trainer totalmente carregado e inicializado');
    
    // Rastrear página inicial
    Analytics.trackPageView('Página Inicial');
    
    // Verificar performance
    if ('performance' in window) {
        const loadTime = performance.timing.loadEventEnd - performance.timing.navigationStart;
        console.log(`Tempo de carregamento: ${loadTime}ms`);
        
        if (loadTime > 3000) {
            console.warn('Tempo de carregamento lento. Considere otimizar recursos.');
        }
    }
});

// Handler para erros não capturados em Promises
window.addEventListener('unhandledrejection', function(event) {
    console.error('Promise rejeitada não tratada:', event.reason);
    event.preventDefault();
});

// =============================================================================
// FALLBACKS PARA NAVEGADORES ANTIGOS
// =============================================================================

// Verificar e avisar sobre navegadores desatualizados
function checkBrowserCompatibility() {
    const isIE = /*@cc_on!@*/false || !!document.documentMode;
    const isOldFirefox = typeof InstallTrigger !== 'undefined' && parseFloat(navigator.userAgent.match(/Firefox\/([0-9]+\.)/)[1]) < 60;
    
    if (isIE || isOldFirefox) {
        showBrowserWarning('Seu navegador não é totalmente compatível. Recomendamos atualizar para uma versão mais recente.');
    }
}

function showBrowserWarning(message) {
    const warning = document.createElement('div');
    warning.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        background: #ff9800;
        color: white;
        padding: 10px;
        text-align: center;
        z-index: 10000;
        font-weight: bold;
    `;
    warning.textContent = message;
    document.body.appendChild(warning);
}

// Executar verificação de compatibilidade
checkBrowserCompatibility();

// FIM DO ARQUIVO - Todas as funcionalidades implementadas), style.css = (:root {
    --primary-color: #3498db;
    --secondary-color: #2ecc71;
    --accent-color: #e74c3c;
    --dark-color: #2c3e50;
    --light-color: #ecf0f1;
    --text-color: #333;
    --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    color: var(--text-color);
    background-color: #f8f9fa;
    padding-top: 56px;
}

.navbar {
    background-color: var(--dark-color);
    box-shadow: var(--shadow);
}

.section {
    padding: 80px 0;
    border-bottom: 1px solid #eee;
}

.section-dark {
    background-color: var(--dark-color);
    color: white;
}

.fretboard {
    display: flex;
    flex-direction: column;
    margin: 20px 0;
    background: linear-gradient(to bottom, #8b5a2b, #6b4423);
    padding: 10px;
    border-radius: 8px;
    box-shadow: var(--shadow);
}

.string {
    display: flex;
    position: relative;
    height: 40px;
    margin: 5px 0;
}

.string::before {
    content: '';
    position: absolute;
    left: 0;
    right: 0;
    height: 2px;
    background: linear-gradient(to right, #ddd, #fff, #ddd);
    top: 50%;
    transform: translateY(-50%);
}

.fret {
    flex: 1;
    position: relative;
    border-right: 3px solid #333;
    display: flex;
    justify-content: center;
    align-items: center;
}

.fret:first-child {
    border-left: 3px solid #333;
    min-width: 40px;
    flex: 0 0 40px;
}

.note {
    width: 30px;
    height: 30px;
    border-radius: 50%;
    background-color: var(--secondary-color);
    display: flex;
    justify-content: center;
    align-items: center;
    color: white;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s ease;
    z-index: 10;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

.note:hover {
    transform: scale(1.1);
}

.note.active {
    background-color: var(--accent-color);
}

.note.root {
    background-color: var(--primary-color);
}

.note-playing {
    animation: pulse 0.5s;
}

@keyframes pulse {
    0% {
        transform: scale(1);
    }

    50% {
        transform: scale(1.2);
    }

    100% {
        transform: scale(1);
    }
}

.fret-marker {
    position: absolute;
    width: 10px;
    height: 10px;
    background-color: #fff;
    border-radius: 50%;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}

.string-name {
    position: absolute;
    left: 10px;
    top: 50%;
    transform: translateY(-50%);
    color: white;
    font-weight: bold;
    z-index: 10;
}

.controls {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin: 20px 0;
}

.btn {
    border-radius: 50px;
    padding: 10px 20px;
    font-weight: 600;
    transition: all 0.3s;
}

.btn-primary {
    background-color: var(--primary-color);
    border-color: var(--primary-color);
}

.btn-secondary {
    background-color: var(--secondary-color);
    border-color: var(--secondary-color);
}

.btn-danger {
    background-color: var(--accent-color);
    border-color: var(--accent-color);
}

.btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
}

.visualizer {
    height: 100px;
    background-color: #2c3e50;
    border-radius: 8px;
    margin: 20px 0;
    display: flex;
    align-items: flex-end;
    justify-content: center;
    padding: 10px;
    overflow: hidden;
}

.visualizer-bar {
    width: 6px;
    background-color: var(--primary-color);
    margin: 0 2px;
    border-radius: 3px 3px 0 0;
    transition: height 0.1s ease;
}

.back-to-top {
    position: fixed;
    bottom: 30px;
    right: 30px;
    width: 50px;
    height: 50px;
    border-radius: 50%;
    background-color: var(--primary-color);
    color: white;
    display: none;
    justify-content: center;
    align-items: center;
    font-size: 20px;
    box-shadow: var(--shadow);
    z-index: 1000;
    cursor: pointer;
    transition: all 0.3s;
}

.back-to-top:hover {
    background-color: var(--secondary-color);
    transform: translateY(-5px);
}

.quiz-option {
    padding: 15px;
    border: 2px solid #ddd;
    border-radius: 8px;
    margin: 10px 0;
    cursor: pointer;
    transition: all 0.3s;
}

.quiz-option:hover {
    border-color: var(--primary-color);
}

.quiz-option.selected {
    border-color: var(--primary-color);
    background-color: rgba(52, 152, 219, 0.1);
}

.instrument-selector {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin: 20px 0;
}

.instrument-btn {
    flex: 1;
    min-width: 120px;
}

.rhythm-grid {
    display: grid;
    grid-template-columns: repeat(16, 1fr);
    gap: 5px;
    margin: 20px 0;
}

.rhythm-cell {
    height: 40px;
    background-color: #eee;
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.3s;
}

.rhythm-cell:hover {
    background-color: #ddd;
}

.rhythm-cell.active {
    background-color: var(--secondary-color);
}

.rhythm-cell.beat {
    background-color: #ccc;
}

.rhythm-cell.beat.active {
    background-color: var(--primary-color);
}

.circle-of-fifths {
    position: relative;
    width: 300px;
    height: 300px;
    margin: 0 auto;
}

.tone-circle {
    position: relative;
    width: 100%;
    height: 100%;
    border-radius: 50%;
    background-color: #f8f9fa;
    border: 2px solid #ddd;
}

.circle-note {
    position: absolute;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background-color: var(--primary-color);
    color: white;
    display: flex;
    justify-content: center;
    align-items: center;
    font-weight: bold;
    cursor: pointer;
    transform: translate(-50%, -50%);
    transition: all 0.3s;
}

.circle-note:hover {
    transform: translate(-50%, -50%) scale(1.1);
}

.game-container {
    background-color: white;
    border-radius: 8px;
    padding: 20px;
    box-shadow: var(--shadow);
    margin: 20px 0;
}

.sequence-container {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    margin: 20px 0;
}

.sequence-note {
    width: 50px;
    height: 50px;
    border-radius: 8px;
    background-color: var(--primary-color);
    color: white;
    display: flex;
    justify-content: center;
    align-items: center;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s;
}

.sequence-note:hover {
    transform: scale(1.1);
}

.chord-diagram {
    height: 320px;
    background-color: #fff;
    border-radius: 8px;
    margin: 20px 0;
    display: flex;
    justify-content: center;
    align-items: center;
    box-shadow: var(--shadow);
    position: relative;
}

.tuning-reference {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin: 20px 0;
}

.interactive-btn {
    flex: 1;
    min-width: 100px;
}

.card {
    border: none;
    border-radius: 12px;
    box-shadow: var(--shadow);
    transition: transform 0.3s;
}

.card:hover {
    transform: translateY(-5px);
}

.feature-icon {
    font-size: 3rem;
    color: var(--primary-color);
    margin-bottom: 1rem;
}

h1,
h2,
h3,
h4,
h5,
h6 {
    font-weight: 700;
}

.hero {
    background: linear-gradient(135deg, var(--primary-color), var(--dark-color));
    color: white;
    padding: 120px 0;
    text-align: center;
}

.hero h1 {
    font-size: 3.5rem;
    margin-bottom: 1rem;
}

.hero p {
    font-size: 1.5rem;
    margin-bottom: 2rem;
}

.stat-number {
    font-size: 2.5rem;
    font-weight: 700;
    color: var(--primary-color);
}

.stat-label {
    font-size: 1rem;
    color: var(--dark-color);
}

footer {
    background-color: var(--dark-color);
    color: white;
    padding: 60px 0 30px;
}

.social-links a {
    color: white;
    font-size: 1.5rem;
    margin-right: 15px;
    transition: color 0.3s;
}

.social-links a:hover {
    color: var(--primary-color);
}

@media (max-width: 768px) {
    .hero h1 {
        font-size: 2.5rem;
    }

    .hero p {
        font-size: 1.2rem;
    }

    .controls {
        flex-direction: column;
    }

    .instrument-selector {
        flex-direction: column;
    }

    .rhythm-grid {
        grid-template-columns: repeat(8, 1fr);
    }
}


/* Media queries para responsividade */
@media (max-width: 992px) {
    .hero h1 {
        font-size: 2.2rem !important;
    }

    .hero p {
        font-size: 1.1rem !important;
    }

    .fretboard {
        overflow-x: auto;
        padding: 5px;
    }

    .string {
        min-width: 700px;
        /* Força scroll horizontal no braço */
        height: 35px;
    }

    .note {
        width: 25px;
        height: 25px;
        font-size: 0.8rem;
    }

    .string-name {
        left: 5px;
        font-size: 0.9rem;
    }

    .controls {
        flex-direction: column;
        gap: 8px;
    }

    .btn {
        padding: 8px 16px;
        font-size: 0.9rem;
    }

    .visualizer {
        height: 80px;
    }

    .circle-of-fifths {
        width: 250px;
        height: 250px;
    }

    .circle-note {
        width: 35px;
        height: 35px;
        font-size: 0.8rem;
    }

    .sequence-note {
        width: 40px;
        height: 40px;
        font-size: 0.9rem;
    }

    .instrument-selector {
        flex-direction: column;
    }

    .instrument-btn {
        min-width: 100%;
    }
}

@media (max-width: 576px) {
    .section {
        padding: 50px 0;
    }

    .hero {
        padding: 80px 0;
    }

    .hero h1 {
        font-size: 1.8rem !important;
    }

    .hero p {
        font-size: 1rem !important;
    }

    .card {
        padding: 1.5rem !important;
    }

    .fretboard {
        margin: 10px 0;
    }

    .string {
        height: 30px;
    }

    .note {
        width: 22px;
        height: 22px;
        font-size: 0.7rem;
    }

    .circle-of-fifths {
        width: 200px;
        height: 200px;
    }

    .circle-note {
        width: 30px;
        height: 30px;
        font-size: 0.7rem;
    }

    .sequence-note {
        width: 35px;
        height: 35px;
    }

    .navbar-brand {
        font-size: 1.1rem;
    }

    .back-to-top {
        bottom: 20px;
        right: 20px;
        width: 40px;
        height: 40px;
        font-size: 16px;
    }
}

/* Melhorias de toque para dispositivos móveis */
@media (hover: none) and (pointer: coarse) {

    .note,
    .btn,
    .sequence-note,
    .circle-note,
    .quiz-option {
        min-height: 44px;
        /* Tamanho mínimo para toque */
    }

    .note {
        min-width: 44px;
    }
}







.chord-diagram {
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 20px;
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    position: relative;
}

.chord-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    position: relative;
    width: 180px;
}

.neck-grid {
    display: grid;
    grid-template-columns: repeat(6, 1fr);
    grid-template-rows: repeat(4, 1fr);
    width: 100%;
    height: 200px;
    background: #8b5a2b;
    border: 4px solid #5d4037;
    border-radius: 8px;
    position: relative;
}

.string-line {
    grid-row: 1 / -1;
    width: 2px;
    background: #ccc;
    margin: 0 auto;
}

.fret-line {
    grid-column: 1 / -1;
    height: 2px;
    background: #5d4037;
    margin: 0 auto;
}

.finger {
    background: #e74c3c;
    color: #fff;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    width: 28px;
    height: 28px;
    font-weight: bold;
    margin: auto;
}

.marker {
    position: absolute;
    top: -25px;
    font-weight: bold;
    font-size: 14px;
    color: #fff;
    background: #27ae60;
    width: 18px;
    height: 18px;
    display: flex;
    justify-content: center;
    align-items: center;
    border-radius: 50%;
}

.chord-name {
    margin-top: 8px;
    font-size: 20px;
    font-weight: bold;
    color: #2c3e50;
}
)